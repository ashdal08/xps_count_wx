<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" />

    <!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>xps_dash - XPS Count 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="../_static/./furo_mod.css?v=51d201ec" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">XPS Count 0.1 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><div class="content-icon-container">
    <div class="theme-toggle-container theme-toggle-content">
      <button class="theme-toggle">
        <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
        <svg class="theme-icon-when-auto-light">
          <use href="#svg-sun-with-moon"></use>
        </svg>
        <svg class="theme-icon-when-auto-dark">
          <use href="#svg-moon-with-sun"></use>
        </svg>
        <svg class="theme-icon-when-dark">
          <use href="#svg-moon"></use>
        </svg>
        <svg class="theme-icon-when-light">
          <use href="#svg-sun"></use>
        </svg>
      </button>
    </div>
  </div><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">XPS Count 0.1 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../xps_count.html">Main Program Window</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mainframe.html">mainframe GUI module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plot_server.html">Plot Server</a></li>
</ul>

</div></div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <h1>Source code for xps_dash</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">polars</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pl</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">threading</span>


<span class="kn">import</span><span class="w"> </span><span class="nn">plotly.graph_objects</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">go</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">plotly.io</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pio</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">gevent.pywsgi</span><span class="w"> </span><span class="kn">import</span> <span class="n">WSGIServer</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">waitress</span>

<span class="c1"># import u6</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dependencies</span><span class="w"> </span><span class="kn">import</span> <span class="n">dummy_labjack_u6</span> <span class="k">as</span> <span class="n">u6</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">dash</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">Dash</span><span class="p">,</span>
    <span class="n">html</span><span class="p">,</span>
    <span class="n">Input</span><span class="p">,</span>
    <span class="n">Output</span><span class="p">,</span>
    <span class="n">callback</span><span class="p">,</span>
    <span class="n">dcc</span><span class="p">,</span>
    <span class="n">clientside_callback</span><span class="p">,</span>
    <span class="n">Patch</span><span class="p">,</span>
    <span class="n">State</span><span class="p">,</span>
    <span class="n">ClientsideFunction</span><span class="p">,</span>
    <span class="n">dash_table</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">dash_bootstrap_components</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">dbc</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">dash_bootstrap_templates</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_figure_template</span>

<span class="n">load_figure_template</span><span class="p">([</span><span class="s2">&quot;bootstrap&quot;</span><span class="p">,</span> <span class="s2">&quot;bootstrap_dark&quot;</span><span class="p">])</span>

<span class="n">BOOTSTRAP</span> <span class="o">=</span> <span class="n">pio</span><span class="o">.</span><span class="n">templates</span><span class="p">[</span><span class="s2">&quot;bootstrap&quot;</span><span class="p">]</span>
<span class="n">BOOTSTRAP_DARK</span> <span class="o">=</span> <span class="n">pio</span><span class="o">.</span><span class="n">templates</span><span class="p">[</span><span class="s2">&quot;bootstrap_dark&quot;</span><span class="p">]</span>

<span class="n">LAYOUT</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;autosize&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s2">&quot;margin&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;l&quot;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
        <span class="s2">&quot;r&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
        <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mi">40</span><span class="p">,</span>
        <span class="s2">&quot;t&quot;</span><span class="p">:</span> <span class="mi">40</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;dragmode&quot;</span><span class="p">:</span> <span class="s2">&quot;pan&quot;</span><span class="p">,</span>
    <span class="s2">&quot;font_size&quot;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
    <span class="s2">&quot;hovermode&quot;</span><span class="p">:</span> <span class="s2">&quot;closest&quot;</span><span class="p">,</span>
    <span class="s2">&quot;template&quot;</span><span class="p">:</span> <span class="n">BOOTSTRAP</span><span class="p">,</span>
    <span class="s2">&quot;modebar&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;orientation&quot;</span><span class="p">:</span> <span class="s2">&quot;v&quot;</span><span class="p">},</span>
<span class="p">}</span>
<span class="sd">&quot;&quot;&quot;Dictionary describing the layout for the plot area of the dash app.&quot;&quot;&quot;</span>

<span class="n">CONFIG</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;scrollZoom&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s2">&quot;displaylogo&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s2">&quot;toImageButtonOptions&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;svg&quot;</span><span class="p">,</span>
        <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="s2">&quot;custom_image&quot;</span><span class="p">,</span>
        <span class="s2">&quot;scale&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;modeBarButtonsToRemove&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;select2d&quot;</span><span class="p">,</span> <span class="s2">&quot;lasso2d&quot;</span><span class="p">],</span>
<span class="p">}</span>
<span class="sd">&quot;&quot;&quot;Dictionary describing the configuration of the plotly Figure object.&quot;&quot;&quot;</span>

<span class="n">THEMES</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;bootstrap&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cerulean&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cosmo&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cyborg&quot;</span><span class="p">,</span>
    <span class="s2">&quot;darkly&quot;</span><span class="p">,</span>
    <span class="s2">&quot;flatly&quot;</span><span class="p">,</span>
    <span class="s2">&quot;journal&quot;</span><span class="p">,</span>
    <span class="s2">&quot;litera&quot;</span><span class="p">,</span>
    <span class="s2">&quot;lumen&quot;</span><span class="p">,</span>
    <span class="s2">&quot;lux&quot;</span><span class="p">,</span>
    <span class="s2">&quot;materia&quot;</span><span class="p">,</span>
    <span class="s2">&quot;minty&quot;</span><span class="p">,</span>
    <span class="s2">&quot;morph&quot;</span><span class="p">,</span>
    <span class="s2">&quot;pulse&quot;</span><span class="p">,</span>
    <span class="s2">&quot;quartz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;sandstone&quot;</span><span class="p">,</span>
    <span class="s2">&quot;simplex&quot;</span><span class="p">,</span>
    <span class="s2">&quot;sketchy&quot;</span><span class="p">,</span>
    <span class="s2">&quot;slate&quot;</span><span class="p">,</span>
    <span class="s2">&quot;solar&quot;</span><span class="p">,</span>
    <span class="s2">&quot;spacelab&quot;</span><span class="p">,</span>
    <span class="s2">&quot;superhero&quot;</span><span class="p">,</span>
    <span class="s2">&quot;united&quot;</span><span class="p">,</span>
    <span class="s2">&quot;vapor&quot;</span><span class="p">,</span>
    <span class="s2">&quot;yeti&quot;</span><span class="p">,</span>
    <span class="s2">&quot;zephyr&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="sd">&quot;&quot;&quot;List of theme names for the dash app.&quot;&quot;&quot;</span>


<div class="viewcode-block" id="reset_fig">
<a class="viewcode-back" href="../xps_dash.html#xps_dash.reset_fig">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">reset_fig</span><span class="p">(</span><span class="n">theme_dark</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">batch_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method to create blank plot figure.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    theme_dark : bool, optional</span>
<span class="sd">        Boolean indicating if the figure has to use a dark theme template, by default False</span>
<span class="sd">    batch_mode : bool, optional</span>
<span class="sd">        Boolean indicating if the measurement type is a batch mode measurement, by default False</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    plotly.graph_objects.Figure</span>
<span class="sd">        The plotly figure object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">trace_name</span> <span class="o">=</span> <span class="s2">&quot;pass_1&quot;</span>
    <span class="k">if</span> <span class="n">batch_mode</span><span class="p">:</span>
        <span class="n">trace_name</span> <span class="o">=</span> <span class="s2">&quot;b1_pass_1&quot;</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="p">[],</span> <span class="n">y</span><span class="o">=</span><span class="p">[],</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;markers+lines&quot;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">marker_size</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">trace_name</span><span class="p">)],</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span>
            <span class="o">**</span><span class="n">LAYOUT</span><span class="p">,</span>
            <span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;Binding Energy [eV]&quot;</span><span class="p">,</span>
            <span class="n">yaxis_title</span><span class="o">=</span><span class="s2">&quot;Counts&quot;</span><span class="p">,</span>
            <span class="n">uirevision</span><span class="o">=</span><span class="s2">&quot;no_change&quot;</span><span class="p">,</span>
            <span class="n">legend</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;orientation&quot;</span><span class="p">:</span> <span class="s2">&quot;h&quot;</span><span class="p">,</span>
                <span class="s2">&quot;xanchor&quot;</span><span class="p">:</span> <span class="s2">&quot;center&quot;</span><span class="p">,</span>
                <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">addPlotRefLines</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">theme_dark</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">template</span><span class="o">=</span><span class="n">BOOTSTRAP_DARK</span><span class="p">))</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">updateRefLinesTheme</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span></div>



<div class="viewcode-block" id="addPlotRefLines">
<a class="viewcode-back" href="../xps_dash.html#xps_dash.addPlotRefLines">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">addPlotRefLines</span><span class="p">(</span><span class="n">fig</span><span class="p">:</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method to add reference photoelectron spectral lines to the plot figure.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fig : plotly.graph_objects.Figure</span>
<span class="sd">        The plotly graph object in which plot reference lines are to be added.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    plotly.graph_objects.Figure</span>
<span class="sd">        The plotly Figure object after adding the reference lines.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_vline</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="mf">83.95</span><span class="p">,</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#B3DF72&quot;</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">dash</span><span class="o">=</span><span class="s2">&quot;dash&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">opacity</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\large \text{Au 4f}_\text{7/2}$&quot;</span><span class="p">,</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_vline</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="mf">87.9</span><span class="p">,</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#FD9891&quot;</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">dash</span><span class="o">=</span><span class="s2">&quot;dash&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">opacity</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\large \text{Au 4f}_\text{5/2}$&quot;</span><span class="p">,</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_vline</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="mf">284.4</span><span class="p">,</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#FEC195&quot;</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">dash</span><span class="o">=</span><span class="s2">&quot;dash&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">opacity</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\large \text{C 1s}$&quot;</span><span class="p">,</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_vline</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="mf">72.84</span><span class="p">,</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#F5CD47&quot;</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">dash</span><span class="o">=</span><span class="s2">&quot;dash&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">opacity</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\large \text{Al 2p}_\text{3/2}$&quot;</span><span class="p">,</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_vline</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="mf">532.70</span><span class="p">,</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#7EE2B8&quot;</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">dash</span><span class="o">=</span><span class="s2">&quot;dash&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">opacity</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\large \text{O 1s}$&quot;</span><span class="p">,</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_vline</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="mi">118</span><span class="p">,</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#9DD9EE&quot;</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">dash</span><span class="o">=</span><span class="s2">&quot;dash&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">opacity</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\large \text{Al 2s}$&quot;</span><span class="p">,</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span></div>



<div class="viewcode-block" id="updateRefLinesTheme">
<a class="viewcode-back" href="../xps_dash.html#xps_dash.updateRefLinesTheme">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">updateRefLinesTheme</span><span class="p">(</span><span class="n">fig</span><span class="p">:</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">,</span> <span class="n">dark_theme</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method to change the colors of the reference lines when the theme template is changed in the plotly Fgiure between dark and light.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fig : plotly.graph_objects.Figure</span>
<span class="sd">        The plotly Figure object in which the reference lines exist.</span>
<span class="sd">    dark_theme : bool, optional</span>
<span class="sd">        Boolean indicating if the dark theme template of the Figure is on., by default False</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    plotly.graph_objects.Figure</span>
<span class="sd">        The plotly Figure object with the updated colors of the reference lines.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">dark_theme</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_traces</span><span class="p">(</span>
            <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#B3DF72&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">selector</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\large \text{Au 4f}_\text{7/2}$&quot;</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_traces</span><span class="p">(</span>
            <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#FD9891&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">selector</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\large \text{Au 4f}_\text{5/2}$&quot;</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_traces</span><span class="p">(</span>
            <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#FEC195&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">selector</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\large \text{C 1s}$&quot;</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_traces</span><span class="p">(</span>
            <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#F5CD47&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">selector</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\large \text{Al 2p}_\text{3/2}$&quot;</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_traces</span><span class="p">(</span>
            <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#7EE2B8&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">selector</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\large \text{O 1s}$&quot;</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_traces</span><span class="p">(</span>
            <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#9DD9EE&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">selector</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\large \text{Al 2s}$&quot;</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_traces</span><span class="p">(</span>
            <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#5B7F24&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">selector</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\large \text{Au 4f}_\text{7/2}$&quot;</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_traces</span><span class="p">(</span>
            <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#C9372C&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">selector</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\large \text{Au 4f}_\text{5/2}$&quot;</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_traces</span><span class="p">(</span>
            <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#C25100&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">selector</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\large \text{C 1s}$&quot;</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_traces</span><span class="p">(</span>
            <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#946F00&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">selector</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\large \text{Al 2p}_\text{3/2}$&quot;</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_traces</span><span class="p">(</span>
            <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#1F845A&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">selector</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\large \text{O 1s}$&quot;</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_traces</span><span class="p">(</span>
            <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#227D9B&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">selector</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\large \text{Al 2s}$&quot;</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span></div>



<div class="viewcode-block" id="addOrUpdatePlotTraceData">
<a class="viewcode-back" href="../xps_dash.html#xps_dash.addOrUpdatePlotTraceData">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">addOrUpdatePlotTraceData</span><span class="p">(</span>
    <span class="n">fig</span><span class="p">:</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">,</span> <span class="n">pass_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">x_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">y_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">trace_name</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method to add or update traces in the plotly Figure object. To be used whenever a new point is obtained from the instrument.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fig : plotly.graph_objects.Figure</span>
<span class="sd">        The plotly Figure object in which the traces are to be added or updated.</span>
<span class="sd">    pass_index : int</span>
<span class="sd">        Integer indicating the index of the trace to be added or updated.</span>
<span class="sd">    x_data : pandas.Series</span>
<span class="sd">        The data for the x-coordinate of the trace points.</span>
<span class="sd">    y_data : pandas.Series</span>
<span class="sd">        The data for the y-coordinate of the trace points.</span>
<span class="sd">    trace_name : str</span>
<span class="sd">        The name of the trace to be added or updated.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    plotly.graph_objects.Figure</span>
<span class="sd">        The plotly Figure object returned after adding or updating the trace.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">existing_passes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fig</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">existing_passes</span> <span class="o">&lt;</span> <span class="n">pass_index</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
            <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="n">x_data</span><span class="p">,</span>
                <span class="n">y</span><span class="o">=</span><span class="n">y_data</span><span class="p">,</span>
                <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;markers+lines&quot;</span><span class="p">,</span>
                <span class="n">line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">marker_size</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="n">trace_name</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_traces</span><span class="p">(</span>
        <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">x</span><span class="o">=</span><span class="n">x_data</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">y_data</span><span class="p">,</span>
        <span class="n">selector</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">trace_name</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span></div>



<div class="viewcode-block" id="DataBackend">
<a class="viewcode-back" href="../xps_dash.html#xps_dash.DataBackend">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">DataBackend</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class for the GUI backend.</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    connectLabJack:</span>
<span class="sd">        Connect to the Labjack U6 device.</span>
<span class="sd">    bindingEnergyToVolt:</span>
<span class="sd">        Convert the binding energy to voltage for the MAX5216 DAC.</span>
<span class="sd">    setSpiVoltage:</span>
<span class="sd">        Set the voltage at the MAX5216 DAC.</span>
<span class="sd">    startMeasurement:</span>
<span class="sd">        Start the measurement process.</span>
<span class="sd">    runSingleMeasurement:</span>
<span class="sd">        Run a single measurement.</span>
<span class="sd">    runBatchMeasurement:</span>
<span class="sd">        Run a batch measurement.</span>
<span class="sd">    saveMeasurementData:</span>
<span class="sd">        Save the measurement data to a CSV file.</span>
<span class="sd">    interruptionClicked:</span>
<span class="sd">        Handle the interruption of the measurement.</span>
<span class="sd">    onClose:</span>
<span class="sd">        Method fired when the close button is clicked.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">BATCH_START_EV</span> <span class="o">=</span> <span class="mi">0</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Index of the start energy value in the batch input table.&quot;&quot;&quot;</span>
    <span class="n">BATCH_END_EV</span> <span class="o">=</span> <span class="mi">1</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Index of the end energy value in the batch input table.&quot;&quot;&quot;</span>
    <span class="n">BATCH_STEP_EV</span> <span class="o">=</span> <span class="mi">2</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Index of the step energy value in the batch input table.&quot;&quot;&quot;</span>
    <span class="n">BATCH_TIME_PER_STEP</span> <span class="o">=</span> <span class="mi">3</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Index of the time per step value in the batch input table.&quot;&quot;&quot;</span>
    <span class="n">BATCH_PASSES</span> <span class="o">=</span> <span class="mi">4</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Index of the number of passes value in the batch input table.&quot;&quot;&quot;</span>
    <span class="n">EXCITATION_AL</span> <span class="o">=</span> <span class="mf">1486.6</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The excitation energy for Aluminium cathode.&quot;&quot;&quot;</span>
    <span class="n">EXCITATION_MG</span> <span class="o">=</span> <span class="mf">1253.6</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The excitation energy for Magnesium cathode.&quot;&quot;&quot;</span>
    <span class="n">U6_MOSI_PIN_NUM</span> <span class="o">=</span> <span class="mi">2</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The MOSI pin number for the Labjack U6.&quot;&quot;&quot;</span>
    <span class="n">U6_MISO_PIN_NUM</span> <span class="o">=</span> <span class="mi">4</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The MISO pin number for the Labjack U6.&quot;&quot;&quot;</span>
    <span class="n">U6_CLK_PIN_NUM</span> <span class="o">=</span> <span class="mi">1</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The CLK pin number for the Labjack U6.&quot;&quot;&quot;</span>
    <span class="n">U6_CS_PIN_NUM</span> <span class="o">=</span> <span class="mi">3</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The CS pin number for the Labjack U6.&quot;&quot;&quot;</span>
    <span class="n">DEP_PATH</span> <span class="o">=</span> <span class="s2">&quot;.</span><span class="se">\\</span><span class="s2">src</span><span class="se">\\</span><span class="s2">dependencies</span><span class="se">\\</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Path for all the files that the program requires to function.&quot;&quot;&quot;</span>

    <span class="n">u6_labjack</span><span class="p">:</span> <span class="n">u6</span><span class="o">.</span><span class="n">U6</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Lajack U6 object for the measurement.&quot;&quot;&quot;</span>
    <span class="n">labjack_connect</span><span class="p">:</span> <span class="nb">bool</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Boolean to check if the Labjack is connected.&quot;&quot;&quot;</span>
    <span class="n">data_table</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Polars DataFrame to store the measurement data.&quot;&quot;&quot;</span>
    <span class="n">pass_row_indexes</span><span class="p">:</span> <span class="nb">list</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;List of row indices indicating start of new passes.&quot;&quot;&quot;</span>
    <span class="n">typ_schema</span><span class="p">:</span> <span class="nb">dict</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dictionary indicating the scheme for the types in the polars dataframe.&quot;&quot;&quot;</span>
    <span class="n">measurement_thread</span><span class="p">:</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Thread object to run the measurement.&quot;&quot;&quot;</span>
    <span class="n">excitation_voltage</span><span class="p">:</span> <span class="nb">float</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Selected excitation voltage for the measurement.&quot;&quot;&quot;</span>
    <span class="n">plot_fig</span><span class="p">:</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plotly figure object to plot the measurement data.&quot;&quot;&quot;</span>
    <span class="n">plot_file_name</span><span class="p">:</span> <span class="nb">str</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;HTML plot file name.&quot;&quot;&quot;</span>
    <span class="n">meas_interrupted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Boolean to check if the measurement was interrupted.&quot;&quot;&quot;</span>
    <span class="n">meas_interrupt_id</span><span class="p">:</span> <span class="nb">int</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ID of the button that was clicked to interrupt the measurement.&quot;&quot;&quot;</span>
    <span class="n">meas_running</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Boolean to check if the measurement is running.&quot;&quot;&quot;</span>
    <span class="n">current_binding_energy</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Variable holding the value of the current binding energy of the measurement.&quot;&quot;&quot;</span>
    <span class="n">current_kinetic_energy</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Variable holding the current kinetic energy of the measurement.&quot;&quot;&quot;</span>
    <span class="n">setpoint_ev</span><span class="p">:</span> <span class="nb">float</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Duplicate variable for the current binding energy of the measurement.&quot;&quot;&quot;</span>
    <span class="n">current_progress</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Integer indicating the current progress percentage of the measurement.&quot;&quot;&quot;</span>
    <span class="n">remaining_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Variable with the remaining time for the measurement in minutes.&quot;&quot;&quot;</span>
    <span class="n">elapsed_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Variable with the elapsed time of the measurement in minutes.&quot;&quot;&quot;</span>
    <span class="n">total_steps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Integer indicating the total number of steps in the measurement.&quot;&quot;&quot;</span>
    <span class="n">total_batch_passes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Integer holding the total number of passes during the batch mode measurement.&quot;&quot;&quot;</span>
    <span class="n">batch_pass_no</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Integer holding the current pass number during a batch measurement.&quot;&quot;&quot;</span>
    <span class="n">batch_step_no</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Integer holding the current step number during a batch measurement.&quot;&quot;&quot;</span>
    <span class="n">meas_completed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Boolean indicating if a measurement is completed.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the main window of the program.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connectLabjack</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_fig</span> <span class="o">=</span> <span class="n">reset_fig</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plot_file_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">src</span><span class="se">\\</span><span class="s2">dependencies</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;plt_dat.html&quot;</span><span class="p">])</span>

<div class="viewcode-block" id="DataBackend.connectLabjack">
<a class="viewcode-back" href="../xps_dash.html#xps_dash.DataBackend.connectLabjack">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">connectLabjack</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Connect to the Labjack U6 device.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">u6_labjack</span> <span class="o">=</span> <span class="n">u6</span><span class="o">.</span><span class="n">U6</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">u6_labjack</span><span class="o">.</span><span class="n">getCalibrationData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">u6_labjack</span><span class="o">.</span><span class="n">configIO</span><span class="p">(</span><span class="n">EnableCounter0</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># ljud.eDAC(self.u6_labjack, 1, 3)  # Set the reference voltage for the MAX5216 DAC</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">u6_labjack</span><span class="o">.</span><span class="n">getFeedback</span><span class="p">(</span><span class="n">u6</span><span class="o">.</span><span class="n">DAC1_8</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u6_labjack</span><span class="o">.</span><span class="n">voltageToDACBits</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labjack_connect</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="DataBackend.bindingEnergyToVolt">
<a class="viewcode-back" href="../xps_dash.html#xps_dash.DataBackend.bindingEnergyToVolt">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">bindingEnergyToVolt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">binding_energy</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert the binding energy to voltage for the MAX5216 DAC.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        binding_energy : float</span>
<span class="sd">            The binding energy value.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The voltage value for the MAX5216 DAC.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setpoint_ev</span> <span class="o">=</span> <span class="n">binding_energy</span>
        <span class="n">kinetic_energy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">excitation_voltage</span> <span class="o">-</span> <span class="n">binding_energy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_binding_energy</span> <span class="o">=</span> <span class="n">binding_energy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_kinetic_energy</span> <span class="o">=</span> <span class="n">kinetic_energy</span>
        <span class="k">return</span> <span class="n">kinetic_energy</span> <span class="o">/</span> <span class="mf">498.43</span></div>


<div class="viewcode-block" id="DataBackend.setSpiVoltage">
<a class="viewcode-back" href="../xps_dash.html#xps_dash.DataBackend.setSpiVoltage">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setSpiVoltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volt</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the voltage at the MAX5216 DAC.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        volt : float</span>
<span class="sd">            The voltage value to set at the MAX5216 DAC.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ref_volt_at_MAX5216_DAC</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u6_labjack</span><span class="o">.</span><span class="n">getAIN</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># the reference voltage at the DAC MAX5216</span>
        <span class="n">volt_bits</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
            <span class="n">volt</span> <span class="o">*</span> <span class="mi">65535</span> <span class="o">/</span> <span class="n">ref_volt_at_MAX5216_DAC</span>
        <span class="p">)</span>  <span class="c1"># convert input volts to a 16 bit scaled value with the reference voltage</span>
        <span class="n">volt_bits</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">volt_bits</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span>
        <span class="p">)</span>  <span class="c1"># shift the 16 bit value 6 bits to the left to make it a 22 bit value. Refer to MAX5216 datasheet</span>
        <span class="n">volt_bits</span> <span class="o">|=</span> <span class="p">(</span>
            <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">22</span>
        <span class="p">)</span>  <span class="c1"># set the 23rd bit to 1 to indicate that the first 2 bits are the command bits. Refer to MAX5216 datasheet</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">u6_labjack</span><span class="o">.</span><span class="n">spi</span><span class="p">(</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">volt_bits</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span>
            <span class="n">CSPINNum</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">U6_CS_PIN_NUM</span><span class="p">,</span>
            <span class="n">CLKPinNum</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">U6_CLK_PIN_NUM</span><span class="p">,</span>
            <span class="n">MISOPinNum</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">U6_MISO_PIN_NUM</span><span class="p">,</span>
            <span class="n">MOSIPinNum</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">U6_MOSI_PIN_NUM</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># Set the voltage at DAC0 of the Labjack for comparison with MAX5216.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">u6_labjack</span><span class="o">.</span><span class="n">getFeedback</span><span class="p">(</span><span class="n">u6</span><span class="o">.</span><span class="n">DAC0_8</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u6_labjack</span><span class="o">.</span><span class="n">voltageToDACBits</span><span class="p">(</span><span class="n">volt</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span></div>


<div class="viewcode-block" id="DataBackend.startMeasurement">
<a class="viewcode-back" href="../xps_dash.html#xps_dash.DataBackend.startMeasurement">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">startMeasurement</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">start_ev</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">end_ev</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">step_ev</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">time_per_step</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">pass_no</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">batch_dataframe</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">source_mg</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">batch_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Start the measurement process.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        start_ev : float</span>
<span class="sd">            The start value for the binding energy in the single mode measurement in eV.</span>
<span class="sd">        end_ev : float</span>
<span class="sd">            The end value of the binding energy in the single mode measurement in eV.</span>
<span class="sd">        step_ev : float</span>
<span class="sd">            The step increment value to be used in the single mode measurement in eV.</span>
<span class="sd">        time_per_step : float</span>
<span class="sd">            The time to wait per step during the single mode measurement in s.</span>
<span class="sd">        pass_no : int</span>
<span class="sd">            The no. of passes to be measured during a single mode measurement.</span>
<span class="sd">        batch_dataframe : pandas.DataFrame</span>
<span class="sd">            The pandas Dataframe formed from the dat in the batch mode grid.</span>
<span class="sd">        source_mg : bool</span>
<span class="sd">            Boolean indicating if the source of the X-ray excitation is Mg.</span>
<span class="sd">        batch_mode : bool, optional</span>
<span class="sd">            Boolean indicating if the measurement is a batch mode measurement, by default False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_steps</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_batch_passes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_pass_no</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_step_no</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">source_mg</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">excitation_voltage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EXCITATION_MG</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">excitation_voltage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EXCITATION_AL</span>

        <span class="k">if</span> <span class="n">batch_mode</span><span class="p">:</span>
            <span class="c1"># if Batch Scan tab is selected in the UI. Batch scan mode is 1. Single scan mode is 0.</span>

            <span class="n">total_time_s</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">for</span> <span class="n">row_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">batch_dataframe</span><span class="p">)):</span>
                <span class="n">batch_time</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">start_ev</span> <span class="o">=</span> <span class="n">batch_dataframe</span><span class="p">[</span><span class="s2">&quot;Start [eV]&quot;</span><span class="p">][</span><span class="n">row_index</span><span class="p">]</span>
                <span class="n">end_ev</span> <span class="o">=</span> <span class="n">batch_dataframe</span><span class="p">[</span><span class="s2">&quot;End [eV]&quot;</span><span class="p">][</span><span class="n">row_index</span><span class="p">]</span>
                <span class="n">step_ev</span> <span class="o">=</span> <span class="n">batch_dataframe</span><span class="p">[</span><span class="s2">&quot;Step [eV]&quot;</span><span class="p">][</span><span class="n">row_index</span><span class="p">]</span>
                <span class="n">time_per_step</span> <span class="o">=</span> <span class="n">batch_dataframe</span><span class="p">[</span><span class="s2">&quot;Time [s/eV]&quot;</span><span class="p">][</span><span class="n">row_index</span><span class="p">]</span>
                <span class="n">pass_no</span> <span class="o">=</span> <span class="n">batch_dataframe</span><span class="p">[</span><span class="s2">&quot;Passes&quot;</span><span class="p">][</span><span class="n">row_index</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">start_ev</span><span class="p">):</span>
                    <span class="k">break</span>
                <span class="n">batch_time</span> <span class="o">=</span> <span class="p">(</span><span class="n">time_per_step</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">pass_no</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">end_ev</span> <span class="o">-</span> <span class="n">start_ev</span><span class="p">)</span> <span class="o">/</span> <span class="n">step_ev</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">total_time_s</span> <span class="o">+=</span> <span class="n">batch_time</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">total_steps</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">((</span><span class="n">end_ev</span> <span class="o">-</span> <span class="n">start_ev</span><span class="p">)</span> <span class="o">/</span> <span class="n">step_ev</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">pass_no</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">total_batch_passes</span> <span class="o">+=</span> <span class="n">pass_no</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">elapsed_time</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remaining_time</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">total_time_s</span> <span class="o">/</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_progress</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measurement_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">runBatchMeasurement</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">batch_dataframe</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_fig</span> <span class="o">=</span> <span class="n">reset_fig</span><span class="p">(</span><span class="n">batch_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">total_steps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">abs</span><span class="p">((</span><span class="n">end_ev</span> <span class="o">-</span> <span class="n">start_ev</span><span class="p">)</span> <span class="o">/</span> <span class="n">step_ev</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">pass_no</span><span class="p">)</span>
            <span class="n">total_time_s</span> <span class="o">=</span> <span class="n">time_per_step</span> <span class="o">*</span> <span class="n">pass_no</span> <span class="o">*</span> <span class="p">((</span><span class="n">end_ev</span> <span class="o">-</span> <span class="n">start_ev</span><span class="p">)</span> <span class="o">/</span> <span class="n">step_ev</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remaining_time</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">total_time_s</span> <span class="o">/</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">elapsed_time</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_progress</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">measurement_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span>
                <span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">runSingleMeasurement</span><span class="p">,</span>
                <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">start_ev</span><span class="p">,</span> <span class="n">end_ev</span><span class="p">,</span> <span class="n">step_ev</span><span class="p">,</span> <span class="n">time_per_step</span><span class="p">,</span> <span class="n">pass_no</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_fig</span> <span class="o">=</span> <span class="n">reset_fig</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">typ_schema</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Binding Energy [eV]&quot;</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">Float64</span><span class="p">,</span>
            <span class="s2">&quot;Pass No.&quot;</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">Float64</span><span class="p">,</span>
            <span class="s2">&quot;Time_per_step [s]&quot;</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">Float64</span><span class="p">,</span>
            <span class="s2">&quot;Counts&quot;</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">Float64</span><span class="p">,</span>
            <span class="s2">&quot;Counts_per_milli [/ms]&quot;</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">Float64</span><span class="p">,</span>
            <span class="s2">&quot;U6_DAC0_Voltage [V]&quot;</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">Float64</span><span class="p">,</span>
            <span class="s2">&quot;MAX5216_DAC_Voltage [V]&quot;</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">Float64</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">data_temp</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Binding Energy [eV]&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Pass No.&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Time_per_step [s]&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Counts&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Counts_per_milli [/ms]&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;U6_DAC0_Voltage [V]&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;MAX5216_DAC_Voltage [V]&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_table</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">data_temp</span><span class="p">,</span>
            <span class="n">schema</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">typ_schema</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">meas_running</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meas_completed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meas_interrupted</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span></div>


<div class="viewcode-block" id="DataBackend.runSingleMeasurement">
<a class="viewcode-back" href="../xps_dash.html#xps_dash.DataBackend.runSingleMeasurement">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">runSingleMeasurement</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">start_ev</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">end_ev</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">step_ev</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">time_per_step</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">pass_no</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">batch_no</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">batch_pass_no</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">type_batch</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run a single measurement.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        start_ev : float</span>
<span class="sd">            The starting energy value for the measurement in eV.</span>
<span class="sd">        end_ev : float</span>
<span class="sd">            The ending energy value for the measurement in eV.</span>
<span class="sd">        step_ev : float</span>
<span class="sd">            The step width for the measurement in eV.</span>
<span class="sd">        time_per_step : float</span>
<span class="sd">            The time per step for the measurement in s.</span>
<span class="sd">        pass_no : int</span>
<span class="sd">            The number of passes for the measurement.</span>
<span class="sd">        batch_no : int</span>
<span class="sd">            The current batch number of the measurement if in batch mode.</span>
<span class="sd">        batch_pass_no : int</span>
<span class="sd">            The current pass no. of the meaasurement if in batch mode.</span>
<span class="sd">        type_batch : bool</span>
<span class="sd">            The type of measurement. True for batch measurement, False for single measurement, by default False.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setSpiVoltage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bindingEnergyToVolt</span><span class="p">(</span><span class="n">start_ev</span><span class="p">))</span>

        <span class="n">pass_index</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">plot_dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
            <span class="s2">&quot;Binding Energy [eV]&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Counts&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="p">})</span>

        <span class="n">step_no</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">while</span> <span class="n">pass_index</span> <span class="o">&lt;=</span> <span class="n">pass_no</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">u6_labjack</span><span class="o">.</span><span class="n">getFeedback</span><span class="p">(</span><span class="n">u6</span><span class="o">.</span><span class="n">Counter0</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">__refresh_time</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">__refresh_time</span> <span class="o">&lt;=</span> <span class="n">time_per_step</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meas_interrupted</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">if</span> <span class="n">__refresh_time</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">time_per_step</span><span class="p">:</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">__refresh_time</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">time_per_step</span> <span class="o">-</span> <span class="n">__refresh_time</span><span class="p">)</span>
                    <span class="k">break</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meas_interrupted</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">meas_interrupted</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">meas_completed</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">meas_running</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_progress</span> <span class="o">=</span> <span class="mi">100</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="n">counts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u6_labjack</span><span class="o">.</span><span class="n">getFeedback</span><span class="p">(</span><span class="n">u6</span><span class="o">.</span><span class="n">Counter0</span><span class="p">(</span><span class="kc">False</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">time_taken</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>  <span class="c1"># record in s</span>
            <span class="n">binding_energy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setpoint_ev</span>
            <span class="n">counts_per_milli</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">counts</span> <span class="o">/</span> <span class="p">(</span><span class="n">time_taken</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">),</span> <span class="mi">6</span><span class="p">)</span>
            <span class="n">u6_dac0_voltage</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u6_labjack</span><span class="o">.</span><span class="n">getAIN</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="mi">6</span><span class="p">)</span>
            <span class="n">max5216_dac_voltage</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u6_labjack</span><span class="o">.</span><span class="n">getAIN</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="mi">6</span><span class="p">)</span>

            <span class="n">new_data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;Binding Energy [eV]&quot;</span><span class="p">:</span> <span class="n">binding_energy</span><span class="p">,</span>
                <span class="s2">&quot;Pass No.&quot;</span><span class="p">:</span> <span class="n">pass_index</span><span class="p">,</span>
                <span class="s2">&quot;Time_per_step [s]&quot;</span><span class="p">:</span> <span class="n">time_taken</span><span class="p">,</span>
                <span class="s2">&quot;Counts&quot;</span><span class="p">:</span> <span class="n">counts</span><span class="p">,</span>
                <span class="s2">&quot;Counts_per_milli [/ms]&quot;</span><span class="p">:</span> <span class="n">counts_per_milli</span><span class="p">,</span>
                <span class="s2">&quot;U6_DAC0_Voltage [V]&quot;</span><span class="p">:</span> <span class="n">u6_dac0_voltage</span><span class="p">,</span>
                <span class="s2">&quot;MAX5216_DAC_Voltage [V]&quot;</span><span class="p">:</span> <span class="n">max5216_dac_voltage</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="n">new_plot_point</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
                <span class="s2">&quot;Binding Energy [eV]&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">binding_energy</span><span class="p">],</span>
                <span class="s2">&quot;Counts&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">counts</span><span class="p">],</span>
            <span class="p">})</span>

            <span class="n">plot_dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">plot_dataframe</span><span class="p">,</span> <span class="n">new_plot_point</span><span class="p">])</span>

            <span class="n">new_df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">new_data</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">typ_schema</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_table</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">data_table</span><span class="p">,</span> <span class="n">new_df</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">type_batch</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plot_fig</span> <span class="o">=</span> <span class="n">addOrUpdatePlotTraceData</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">plot_fig</span><span class="p">,</span>
                    <span class="n">pass_index</span><span class="p">,</span>
                    <span class="n">plot_dataframe</span><span class="p">[</span><span class="s2">&quot;Binding Energy [eV]&quot;</span><span class="p">],</span>
                    <span class="n">plot_dataframe</span><span class="p">[</span><span class="s2">&quot;Counts&quot;</span><span class="p">],</span>
                    <span class="sa">f</span><span class="s2">&quot;pass_</span><span class="si">{</span><span class="n">pass_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plot_fig</span> <span class="o">=</span> <span class="n">addOrUpdatePlotTraceData</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">plot_fig</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">batch_pass_no</span><span class="p">,</span>
                    <span class="n">plot_dataframe</span><span class="p">[</span><span class="s2">&quot;Binding Energy [eV]&quot;</span><span class="p">],</span>
                    <span class="n">plot_dataframe</span><span class="p">[</span><span class="s2">&quot;Counts&quot;</span><span class="p">],</span>
                    <span class="sa">f</span><span class="s2">&quot;b</span><span class="si">{</span><span class="n">batch_no</span><span class="si">}</span><span class="s2">_pass_</span><span class="si">{</span><span class="n">pass_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="c1"># if not type_batch:</span>
            <span class="c1">#     if existing_passes &lt; pass_index:</span>
            <span class="c1">#         self.plot_fig.add_trace(</span>
            <span class="c1">#             go.Scatter(</span>
            <span class="c1">#                 x=plot_dataframe[&quot;Binding Energy [eV]&quot;],</span>
            <span class="c1">#                 y=plot_dataframe[&quot;Counts&quot;],</span>
            <span class="c1">#                 mode=&quot;markers+lines&quot;,</span>
            <span class="c1">#                 line_width=1,</span>
            <span class="c1">#                 marker_size=4,</span>
            <span class="c1">#                 name=f&quot;pass_{pass_index}&quot;,</span>
            <span class="c1">#             )</span>
            <span class="c1">#         )</span>
            <span class="c1">#     self.plot_fig.update_traces(</span>
            <span class="c1">#         overwrite=False,</span>
            <span class="c1">#         x=plot_dataframe[&quot;Binding Energy [eV]&quot;],</span>
            <span class="c1">#         y=plot_dataframe[&quot;Counts&quot;],</span>
            <span class="c1">#         selector=dict(name=f&quot;pass_{pass_index}&quot;),</span>
            <span class="c1">#     )</span>
            <span class="c1"># else:</span>
            <span class="c1">#     if existing_passes &lt; self.batch_pass_no:</span>
            <span class="c1">#         self.plot_fig.add_trace(</span>
            <span class="c1">#             go.Scatter(</span>
            <span class="c1">#                 x=plot_dataframe[&quot;Binding Energy [eV]&quot;],</span>
            <span class="c1">#                 y=plot_dataframe[&quot;Counts&quot;],</span>
            <span class="c1">#                 mode=&quot;markers+lines&quot;,</span>
            <span class="c1">#                 line_width=1,</span>
            <span class="c1">#                 marker_size=4,</span>
            <span class="c1">#                 name=f&quot;b{batch_no}_pass_{pass_index}&quot;,</span>
            <span class="c1">#             )</span>
            <span class="c1">#         )</span>
            <span class="c1">#     self.plot_fig.update_traces(</span>
            <span class="c1">#         overwrite=False,</span>
            <span class="c1">#         x=plot_dataframe[&quot;Binding Energy [eV]&quot;],</span>
            <span class="c1">#         y=plot_dataframe[&quot;Counts&quot;],</span>
            <span class="c1">#         selector=dict(name=f&quot;b{batch_no}_pass_{pass_index}&quot;),</span>
            <span class="c1">#     )</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_fig</span><span class="o">.</span><span class="n">write_html</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plot_file_name</span><span class="p">,</span>
                <span class="n">config</span><span class="o">=</span><span class="n">CONFIG</span><span class="p">,</span>
                <span class="n">include_plotlyjs</span><span class="o">=</span><span class="s2">&quot;cdn&quot;</span><span class="p">,</span>
                <span class="n">include_mathjax</span><span class="o">=</span><span class="s2">&quot;cdn&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">type_batch</span><span class="p">:</span>
                <span class="n">step_no</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_step_no</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_progress</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">step_no</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_steps</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remaining_time</span> <span class="o">-=</span> <span class="n">time_taken</span> <span class="o">/</span> <span class="mi">60</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">elapsed_time</span> <span class="o">+=</span> <span class="n">time_taken</span> <span class="o">/</span> <span class="mi">60</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">setpoint_ev</span> <span class="o">+</span> <span class="n">step_ev</span> <span class="o">&lt;=</span> <span class="n">end_ev</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setpoint_ev</span> <span class="o">+=</span> <span class="n">step_ev</span>
                <span class="n">step_no</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">type_batch</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">batch_step_no</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setSpiVoltage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bindingEnergyToVolt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setpoint_ev</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setSpiVoltage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bindingEnergyToVolt</span><span class="p">(</span><span class="n">start_ev</span><span class="p">))</span>
                <span class="n">pass_index</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">type_batch</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">batch_pass_no</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">batch_step_no</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">plot_dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
                    <span class="s2">&quot;Binding Energy [eV]&quot;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s2">&quot;Counts&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="p">})</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">type_batch</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_progress</span> <span class="o">=</span> <span class="mi">100</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remaining_time</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meas_completed</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meas_running</span> <span class="o">=</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="DataBackend.runBatchMeasurement">
<a class="viewcode-back" href="../xps_dash.html#xps_dash.DataBackend.runBatchMeasurement">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">runBatchMeasurement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch_dataframe</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run a batch measurement.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        batch_dataframe : pandas.DataFrame</span>
<span class="sd">            The pandas Dataframe with the measurement parameters from the batch mode grid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">row_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">batch_dataframe</span><span class="p">)):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meas_running</span><span class="p">:</span>
                <span class="n">start_ev</span> <span class="o">=</span> <span class="n">batch_dataframe</span><span class="p">[</span><span class="s2">&quot;Start [eV]&quot;</span><span class="p">][</span><span class="n">row_index</span><span class="p">]</span>
                <span class="n">end_ev</span> <span class="o">=</span> <span class="n">batch_dataframe</span><span class="p">[</span><span class="s2">&quot;End [eV]&quot;</span><span class="p">][</span><span class="n">row_index</span><span class="p">]</span>
                <span class="n">step_ev</span> <span class="o">=</span> <span class="n">batch_dataframe</span><span class="p">[</span><span class="s2">&quot;Step [eV]&quot;</span><span class="p">][</span><span class="n">row_index</span><span class="p">]</span>
                <span class="n">time_per_step</span> <span class="o">=</span> <span class="n">batch_dataframe</span><span class="p">[</span><span class="s2">&quot;Time [s/eV]&quot;</span><span class="p">][</span><span class="n">row_index</span><span class="p">]</span>
                <span class="n">pass_no</span> <span class="o">=</span> <span class="n">batch_dataframe</span><span class="p">[</span><span class="s2">&quot;Passes&quot;</span><span class="p">][</span><span class="n">row_index</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">start_ev</span><span class="p">):</span>
                    <span class="k">break</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">runSingleMeasurement</span><span class="p">(</span>
                    <span class="n">start_ev</span><span class="p">,</span> <span class="n">end_ev</span><span class="p">,</span> <span class="n">step_ev</span><span class="p">,</span> <span class="n">time_per_step</span><span class="p">,</span> <span class="n">pass_no</span><span class="p">,</span> <span class="n">row_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_pass_no</span><span class="p">,</span> <span class="kc">True</span>
                <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_progress</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remaining_time</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meas_running</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meas_completed</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_pass_no</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_step_no</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="DataBackend.saveMeasurementData">
<a class="viewcode-back" href="../xps_dash.html#xps_dash.DataBackend.saveMeasurementData">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">saveMeasurementData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;xps_data&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the measurement data to a CSV file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str, optional</span>
<span class="sd">            File name to save the results and plot as, by default &quot;xps_data&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_table</span><span class="o">.</span><span class="n">write_csv</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">current_progress</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="DataBackend.interruptionClicked">
<a class="viewcode-back" href="../xps_dash.html#xps_dash.DataBackend.interruptionClicked">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">interruptionClicked</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the interruption of the measurement.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meas_interrupted</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meas_running</span> <span class="o">=</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="DataBackend.onClose">
<a class="viewcode-back" href="../xps_dash.html#xps_dash.DataBackend.onClose">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">onClose</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method fired when the Shutdown App button is clicked.&quot;&quot;&quot;</span>
        <span class="n">os</span><span class="o">.</span><span class="n">_exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>
</div>



<span class="n">data_backend</span> <span class="o">=</span> <span class="n">DataBackend</span><span class="p">()</span>
<span class="sd">&quot;&quot;&quot;The data processing backend class.&quot;&quot;&quot;</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">reset_fig</span><span class="p">()</span>
<span class="sd">&quot;&quot;&quot;The plotly figure to be displayed in the plot area of the dash app.&quot;&quot;&quot;</span>


<span class="n">app</span> <span class="o">=</span> <span class="n">Dash</span><span class="p">(</span>
    <span class="vm">__name__</span><span class="p">,</span>  <span class="c1"># external_stylesheets=[dbc.themes.BOOTSTRAP, dbc.icons.FONT_AWESOME], #now served locally in the assets folder</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;XPS&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="sd">&quot;&quot;&quot;The dash app variable.&quot;&quot;&quot;</span>

<span class="n">color_mode_switch</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">Span</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">dbc</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span>
            <span class="n">className</span><span class="o">=</span><span class="s2">&quot;fa fa-moon&quot;</span><span class="p">,</span>
            <span class="n">html_for</span><span class="o">=</span><span class="s2">&quot;switch&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">dbc</span><span class="o">.</span><span class="n">Switch</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;switch&quot;</span><span class="p">,</span>
            <span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">className</span><span class="o">=</span><span class="s2">&quot;d-inline-block ms-1&quot;</span><span class="p">,</span>
            <span class="n">persistence</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">dbc</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span>
            <span class="n">className</span><span class="o">=</span><span class="s2">&quot;fa fa-sun&quot;</span><span class="p">,</span>
            <span class="n">html_for</span><span class="o">=</span><span class="s2">&quot;switch&quot;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">],</span>
<span class="p">)</span>
<span class="sd">&quot;&quot;&quot;A dash html Span element for a theme switching button.&quot;&quot;&quot;</span>

<span class="n">offcanvas</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">([</span>
    <span class="n">dbc</span><span class="o">.</span><span class="n">Offcanvas</span><span class="p">(</span>
        <span class="n">dcc</span><span class="o">.</span><span class="n">Markdown</span><span class="p">(</span>
            <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">mathjax</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">className</span><span class="o">=</span><span class="s2">&quot;offcanvas-markdown&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;offcanvas&quot;</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Impedance Spectroscopy&quot;</span><span class="p">,</span>
        <span class="n">is_open</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">class_name</span><span class="o">=</span><span class="s2">&quot;offcanvas-style&quot;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">])</span>
<span class="sd">&quot;&quot;&quot;A dash html div for a canvas that can be rolled into sight when called. Here theory of the impedance analysis is mentioned.&quot;&quot;&quot;</span>

<span class="n">save_file_modal</span> <span class="o">=</span> <span class="n">dbc</span><span class="o">.</span><span class="n">Modal</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">dbc</span><span class="o">.</span><span class="n">ModalHeader</span><span class="p">(</span><span class="n">dbc</span><span class="o">.</span><span class="n">ModalTitle</span><span class="p">(</span><span class="s2">&quot;Save Files as&quot;</span><span class="p">)),</span>
        <span class="n">dbc</span><span class="o">.</span><span class="n">ModalBody</span><span class="p">(</span>
            <span class="n">dbc</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span>
                <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;save-as-file&quot;</span><span class="p">,</span>
                <span class="n">placeholder</span><span class="o">=</span><span class="s2">&quot;Filename without extensions...&quot;</span><span class="p">,</span>
                <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
                <span class="n">value</span><span class="o">=</span><span class="s2">&quot;xps_data&quot;</span><span class="p">,</span>
                <span class="n">pattern</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;[^.</span><span class="se">\\</span><span class="s1">/:*?&quot;&lt;&gt;|]+&#39;</span><span class="p">,</span>
                <span class="c1"># title=r&#39;Filename should not contain .\\/:*?&quot;\&#39;&lt;&gt;|&#39;,</span>
            <span class="p">),</span>
        <span class="p">),</span>
        <span class="n">dbc</span><span class="o">.</span><span class="n">ModalFooter</span><span class="p">([</span>
            <span class="n">dbc</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
                <span class="s2">&quot;Save&quot;</span><span class="p">,</span>
                <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;confirm-save&quot;</span><span class="p">,</span>
                <span class="n">className</span><span class="o">=</span><span class="s2">&quot;ms-auto&quot;</span><span class="p">,</span>
                <span class="n">n_clicks</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">outline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;success&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">dbc</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
                <span class="s2">&quot;Cancel&quot;</span><span class="p">,</span>
                <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;cancel-save&quot;</span><span class="p">,</span>
                <span class="n">className</span><span class="o">=</span><span class="s2">&quot;ms-auto&quot;</span><span class="p">,</span>
                <span class="n">n_clicks</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">outline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;danger&quot;</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">]),</span>
    <span class="p">],</span>
    <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;modal&quot;</span><span class="p">,</span>
    <span class="n">is_open</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
<span class="sd">&quot;&quot;&quot;Dash modal to appear whenever the save button is clicked.&quot;&quot;&quot;</span>


<div class="viewcode-block" id="generate_single_mode_tab_content">
<a class="viewcode-back" href="../xps_dash.html#xps_dash.generate_single_mode_tab_content">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">generate_single_mode_tab_content</span><span class="p">(</span>
    <span class="n">start_ev</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">end_ev</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">ev_step</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">time_step</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">pass_no</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method to generate the content for the Dash container when the single mode tab is clicked.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    start_ev : float</span>
<span class="sd">        The start value in eV to be shown in the start eV field of the Dash app.</span>
<span class="sd">    end_ev : float</span>
<span class="sd">        The end value in eV to be shown in the end eV field of the Dash app.</span>
<span class="sd">    ev_step : float</span>
<span class="sd">        The step value in eV to be shown in the step eV field of the Dash app.</span>
<span class="sd">    time_step : float</span>
<span class="sd">        The time per step in s to be shown in the time per step field of the Dash app.</span>
<span class="sd">    pass_no : int</span>
<span class="sd">        The pass no. to be shown in the no. of passes field in the Dash app.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list</span>
<span class="sd">        A list indicating the child components to be added to the respective Dash container.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">dbc</span><span class="o">.</span><span class="n">Col</span><span class="p">([</span>
            <span class="n">dbc</span><span class="o">.</span><span class="n">InputGroup</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">dbc</span><span class="o">.</span><span class="n">InputGroupText</span><span class="p">(</span>
                        <span class="s2">&quot;Start : &quot;</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="n">dbc</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span>
                        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;number&quot;</span><span class="p">,</span>
                        <span class="n">step</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span>
                        <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;start-ev&quot;</span><span class="p">,</span>
                        <span class="n">value</span><span class="o">=</span><span class="n">start_ev</span><span class="p">,</span>
                        <span class="nb">min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                        <span class="nb">max</span><span class="o">=</span><span class="mf">1486.6</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="n">dbc</span><span class="o">.</span><span class="n">InputGroupText</span><span class="p">(</span>
                        <span class="s2">&quot;eV&quot;</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">],</span>
            <span class="p">),</span>
            <span class="n">dbc</span><span class="o">.</span><span class="n">InputGroup</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">dbc</span><span class="o">.</span><span class="n">InputGroupText</span><span class="p">(</span>
                        <span class="s2">&quot;End : &quot;</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="n">dbc</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span>
                        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;number&quot;</span><span class="p">,</span>
                        <span class="n">step</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span>
                        <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;end-ev&quot;</span><span class="p">,</span>
                        <span class="n">value</span><span class="o">=</span><span class="n">end_ev</span><span class="p">,</span>
                        <span class="nb">min</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span>
                        <span class="nb">max</span><span class="o">=</span><span class="mf">1486.6</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="n">dbc</span><span class="o">.</span><span class="n">InputGroupText</span><span class="p">(</span>
                        <span class="s2">&quot;eV&quot;</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">],</span>
            <span class="p">),</span>
            <span class="n">dbc</span><span class="o">.</span><span class="n">InputGroup</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">dbc</span><span class="o">.</span><span class="n">InputGroupText</span><span class="p">(</span>
                        <span class="s2">&quot;Step width : &quot;</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="n">dbc</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span>
                        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;number&quot;</span><span class="p">,</span>
                        <span class="n">step</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span>
                        <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;ev-step&quot;</span><span class="p">,</span>
                        <span class="n">value</span><span class="o">=</span><span class="n">ev_step</span><span class="p">,</span>
                        <span class="nb">min</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span>
                        <span class="nb">max</span><span class="o">=</span><span class="mf">1486.6</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="n">dbc</span><span class="o">.</span><span class="n">InputGroupText</span><span class="p">(</span>
                        <span class="s2">&quot;eV&quot;</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">],</span>
            <span class="p">),</span>
            <span class="n">dbc</span><span class="o">.</span><span class="n">InputGroup</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">dbc</span><span class="o">.</span><span class="n">InputGroupText</span><span class="p">(</span>
                        <span class="s2">&quot;Time per step : &quot;</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="n">dbc</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span>
                        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;number&quot;</span><span class="p">,</span>
                        <span class="n">step</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                        <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;time-step&quot;</span><span class="p">,</span>
                        <span class="n">value</span><span class="o">=</span><span class="n">time_step</span><span class="p">,</span>
                        <span class="nb">min</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">],</span>
            <span class="p">),</span>
            <span class="n">dbc</span><span class="o">.</span><span class="n">InputGroup</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">dbc</span><span class="o">.</span><span class="n">InputGroupText</span><span class="p">(</span>
                        <span class="s2">&quot;No. of passes : &quot;</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="n">dbc</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span>
                        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;number&quot;</span><span class="p">,</span>
                        <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;meas-passes&quot;</span><span class="p">,</span>
                        <span class="n">value</span><span class="o">=</span><span class="n">pass_no</span><span class="p">,</span>
                        <span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">],</span>
            <span class="p">),</span>
        <span class="p">])</span>
    <span class="p">]</span></div>



<span class="n">single_mode_tab_content</span> <span class="o">=</span> <span class="n">generate_single_mode_tab_content</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot;The Dash content to be shown when the Single mode tab is clicked.&quot;&quot;&quot;</span>


<span class="n">blank_data_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot; &quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">51</span><span class="p">)],</span>
    <span class="s2">&quot;Start [eV]&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">51</span><span class="p">)],</span>
    <span class="s2">&quot;End [eV]&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">51</span><span class="p">)],</span>
    <span class="s2">&quot;Step [eV]&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">51</span><span class="p">)],</span>
    <span class="s2">&quot;Time [s/eV]&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">51</span><span class="p">)],</span>
    <span class="s2">&quot;Passes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">51</span><span class="p">)],</span>
<span class="p">}</span>
<span class="sd">&quot;&quot;&quot;A dictionary to generate black data for the batch mode grid in the Dash app.&quot;&quot;&quot;</span>

<span class="n">blank_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">blank_data_dict</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot;The pandas Dataframe formed from the black_data_dict.&quot;&quot;&quot;</span>


<div class="viewcode-block" id="generate_batch_data_grid">
<a class="viewcode-back" href="../xps_dash.html#xps_dash.generate_batch_data_grid">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">generate_batch_data_grid</span><span class="p">(</span><span class="n">dataframe</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method to generate the content for the Dash container when the batch mode tab is clicked.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dataframe : pandas.DataFrame</span>
<span class="sd">        The pandas Dataframe with the data for the batch mode grid in the Dash app.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list</span>
<span class="sd">        A list with the child entries for the Dash container.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">dbc</span><span class="o">.</span><span class="n">Container</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">dash_table</span><span class="o">.</span><span class="n">DataTable</span><span class="p">(</span>
                    <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;batch-seq&quot;</span><span class="p">,</span>
                    <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span>
                            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span>
                            <span class="s2">&quot;editable&quot;</span><span class="p">:</span> <span class="kc">False</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="s2">&quot; &quot;</span> <span class="k">else</span> <span class="kc">True</span><span class="p">,</span>
                            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;numeric&quot;</span><span class="p">,</span>
                        <span class="p">}</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span>
                    <span class="p">],</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">dataframe</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s2">&quot;records&quot;</span><span class="p">),</span>
                    <span class="n">editable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">fixed_rows</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;headers&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
                    <span class="c1"># filter_action=&quot;native&quot;,</span>
                    <span class="c1"># sort_action=&quot;native&quot;,</span>
                    <span class="n">style_table</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;overflowX&quot;</span><span class="p">:</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;overflowY&quot;</span><span class="p">:</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;border&quot;</span><span class="p">:</span> <span class="s2">&quot;1px solid var(--bs-border-color-translucent)&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="s2">&quot;266px&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;scrollbar-color&quot;</span><span class="p">:</span> <span class="s2">&quot;var(--bs-border-color) transparent&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;scrollbar-width&quot;</span><span class="p">:</span> <span class="s2">&quot;thin&quot;</span><span class="p">,</span>
                    <span class="p">},</span>
                    <span class="n">style_header</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;border&quot;</span><span class="p">:</span> <span class="s2">&quot;1px solid var(--bs-border-color-translucent)&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;border-top&quot;</span><span class="p">:</span> <span class="s2">&quot;0px&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;background-color&quot;</span><span class="p">:</span> <span class="s2">&quot;var(--bs-card-cap-bg)&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;text-color&quot;</span><span class="p">:</span> <span class="s2">&quot;var(--bs-body-color)&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;whiteSpace&quot;</span><span class="p">:</span> <span class="s2">&quot;normal&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;lineHeight&quot;</span><span class="p">:</span> <span class="s2">&quot;18px&quot;</span><span class="p">,</span>
                    <span class="p">},</span>
                    <span class="n">style_data</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;border&quot;</span><span class="p">:</span> <span class="s2">&quot;1px solid var(--bs-border-color-translucent)&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;background-color&quot;</span><span class="p">:</span> <span class="s2">&quot;var(--bs-body-bg)&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;text-color&quot;</span><span class="p">:</span> <span class="s2">&quot;var(--bs-body-color)&quot;</span><span class="p">,</span>
                    <span class="p">},</span>
                    <span class="n">style_data_conditional</span><span class="o">=</span><span class="p">[</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;if&quot;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="s2">&quot;active&quot;</span><span class="p">,</span>
                            <span class="p">},</span>
                            <span class="s2">&quot;backgroundColor&quot;</span><span class="p">:</span> <span class="s2">&quot;var(--bs-focus-ring-color)&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;border&quot;</span><span class="p">:</span> <span class="s2">&quot;1px solid var(--bs-primary)&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;text-color&quot;</span><span class="p">:</span> <span class="s2">&quot;var(--bs-body-color)&quot;</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;if&quot;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s2">&quot;column_id&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
                            <span class="p">},</span>
                            <span class="s2">&quot;border-left&quot;</span><span class="p">:</span> <span class="s2">&quot;0px&quot;</span><span class="p">,</span>
                        <span class="p">},</span>
                    <span class="p">],</span>
                    <span class="n">style_cell</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;textAlign&quot;</span><span class="p">:</span> <span class="s2">&quot;center&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;minWidth&quot;</span><span class="p">:</span> <span class="s2">&quot;72px&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="s2">&quot;72px&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;maxWidth&quot;</span><span class="p">:</span> <span class="s2">&quot;72px&quot;</span><span class="p">,</span>
                        <span class="c1"># &quot;whiteSpace&quot;: &quot;normal&quot;,</span>
                    <span class="p">},</span>
                    <span class="n">style_cell_conditional</span><span class="o">=</span><span class="p">[</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;if&quot;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s2">&quot;column_id&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
                            <span class="p">},</span>
                            <span class="s2">&quot;textAlign&quot;</span><span class="p">:</span> <span class="s2">&quot;center&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;minWidth&quot;</span><span class="p">:</span> <span class="s2">&quot;30px&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="s2">&quot;30px&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;maxWidth&quot;</span><span class="p">:</span> <span class="s2">&quot;30px&quot;</span><span class="p">,</span>
                            <span class="c1"># &quot;whiteSpace&quot;: &quot;normal&quot;,</span>
                        <span class="p">}</span>
                    <span class="p">],</span>
                <span class="p">),</span>
            <span class="p">],</span>
            <span class="n">class_name</span><span class="o">=</span><span class="s2">&quot;table-container-mod&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">]</span></div>



<span class="n">batch_mode_tab_content</span> <span class="o">=</span> <span class="n">generate_batch_data_grid</span><span class="p">(</span><span class="n">blank_data</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot;The batch mode content to be shown in the Dash app when the batch mode tab is clicked.&quot;&quot;&quot;</span>

<span class="n">card</span> <span class="o">=</span> <span class="n">dbc</span><span class="o">.</span><span class="n">Card</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">dbc</span><span class="o">.</span><span class="n">CardHeader</span><span class="p">(</span>
            <span class="n">dbc</span><span class="o">.</span><span class="n">Tabs</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">dbc</span><span class="o">.</span><span class="n">Tab</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Single Mode&quot;</span><span class="p">,</span> <span class="n">tab_id</span><span class="o">=</span><span class="s2">&quot;tab-1&quot;</span><span class="p">),</span>
                    <span class="n">dbc</span><span class="o">.</span><span class="n">Tab</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Batch Mode&quot;</span><span class="p">,</span> <span class="n">tab_id</span><span class="o">=</span><span class="s2">&quot;tab-2&quot;</span><span class="p">),</span>
                <span class="p">],</span>
                <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;card-tabs&quot;</span><span class="p">,</span>
                <span class="n">active_tab</span><span class="o">=</span><span class="s2">&quot;tab-1&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">),</span>
        <span class="n">dbc</span><span class="o">.</span><span class="n">CardBody</span><span class="p">(</span>
            <span class="n">html</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;card-content&quot;</span><span class="p">,</span> <span class="n">className</span><span class="o">=</span><span class="s2">&quot;card-text&quot;</span><span class="p">,</span> <span class="n">children</span><span class="o">=</span><span class="n">batch_mode_tab_content</span><span class="p">),</span>
            <span class="n">class_name</span><span class="o">=</span><span class="s2">&quot;card-body-mod&quot;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">],</span>
    <span class="n">class_name</span><span class="o">=</span><span class="s2">&quot;mb-3&quot;</span><span class="p">,</span>
    <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;meas-select-card&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="sd">&quot;&quot;&quot;A card container to render the tabs for the single mode and batch mode measurements.&quot;&quot;&quot;</span>

<span class="n">source_selection</span> <span class="o">=</span> <span class="n">dbc</span><span class="o">.</span><span class="n">Stack</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">dbc</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span>
            <span class="s2">&quot;X-Ray Source&quot;</span><span class="p">,</span>
            <span class="n">class_name</span><span class="o">=</span><span class="s2">&quot;label-center-mod&quot;</span><span class="p">,</span>
            <span class="n">html_for</span><span class="o">=</span><span class="s2">&quot;source-select&quot;</span><span class="p">,</span>
            <span class="n">align</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">dbc</span><span class="o">.</span><span class="n">Switch</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;source-select&quot;</span><span class="p">,</span>
            <span class="n">class_name</span><span class="o">=</span><span class="s2">&quot;fs-1 form-check-input-mod&quot;</span><span class="p">,</span>
            <span class="n">label_class_name</span><span class="o">=</span><span class="s2">&quot;form-check-label-mod-xps fs-6&quot;</span><span class="p">,</span>
            <span class="c1"># label=&quot;On&quot;,</span>
        <span class="p">),</span>
    <span class="p">],</span>
    <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;horizontal&quot;</span><span class="p">,</span>
    <span class="n">class_name</span><span class="o">=</span><span class="s2">&quot;mx-auto mb-3 justify-content-center&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="sd">&quot;&quot;&quot;Dash components for the switch to select the source of the X-ray excitation.&quot;&quot;&quot;</span>


<span class="n">status_displays</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">dbc</span><span class="o">.</span><span class="n">Row</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">dbc</span><span class="o">.</span><span class="n">Col</span><span class="p">(</span>
                <span class="n">dbc</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span>
                    <span class="s2">&quot;K.E [eV]&quot;</span><span class="p">,</span>
                    <span class="n">class_name</span><span class="o">=</span><span class="s2">&quot;label-center-disp-mod&quot;</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">class_name</span><span class="o">=</span><span class="s2">&quot;justify-content-center&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">dbc</span><span class="o">.</span><span class="n">Col</span><span class="p">(</span>
                <span class="n">dbc</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span>
                    <span class="s2">&quot;B.E [eV]&quot;</span><span class="p">,</span>
                    <span class="n">class_name</span><span class="o">=</span><span class="s2">&quot;label-center-disp-mod&quot;</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">class_name</span><span class="o">=</span><span class="s2">&quot;justify-content-center&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">dbc</span><span class="o">.</span><span class="n">Col</span><span class="p">(</span>
                <span class="n">dbc</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span>
                    <span class="s2">&quot;Elapsed [min]&quot;</span><span class="p">,</span>
                    <span class="n">class_name</span><span class="o">=</span><span class="s2">&quot;label-center-disp-mod&quot;</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">class_name</span><span class="o">=</span><span class="s2">&quot;justify-content-center&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">dbc</span><span class="o">.</span><span class="n">Col</span><span class="p">(</span>
                <span class="n">dbc</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span>
                    <span class="s2">&quot;Remaining [min]&quot;</span><span class="p">,</span>
                    <span class="n">class_name</span><span class="o">=</span><span class="s2">&quot;label-center-disp-mod&quot;</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">class_name</span><span class="o">=</span><span class="s2">&quot;justify-content-center&quot;</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">],</span>
    <span class="p">),</span>
    <span class="n">dbc</span><span class="o">.</span><span class="n">Row</span><span class="p">([</span>
        <span class="n">dbc</span><span class="o">.</span><span class="n">Col</span><span class="p">(</span>
            <span class="n">dbc</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span>
                <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;kin-energy-disp&quot;</span><span class="p">,</span>
                <span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">),</span>
        <span class="n">dbc</span><span class="o">.</span><span class="n">Col</span><span class="p">(</span>
            <span class="n">dbc</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span>
                <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;binding-energy-disp&quot;</span><span class="p">,</span>
                <span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">),</span>
        <span class="n">dbc</span><span class="o">.</span><span class="n">Col</span><span class="p">(</span>
            <span class="n">dbc</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span>
                <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;time-elapsed-disp&quot;</span><span class="p">,</span>
                <span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">),</span>
        <span class="n">dbc</span><span class="o">.</span><span class="n">Col</span><span class="p">(</span>
            <span class="n">dbc</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span>
                <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;time-remain-disp&quot;</span><span class="p">,</span>
                <span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">),</span>
    <span class="p">]),</span>
<span class="p">]</span>
<span class="sd">&quot;&quot;&quot;A list with the child entries to render the status displays of the current binding energy, current kinetic energy, elapsed time and remaining time of the measurement.&quot;&quot;&quot;</span>


<span class="c1"># mathjax = &#39;https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js&#39;</span>
<span class="c1"># # app.scripts.append_script({ &#39;external_url&#39; : mathjax })</span>
<span class="n">app</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">dcc</span><span class="o">.</span><span class="n">Store</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;check-running&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
        <span class="n">dcc</span><span class="o">.</span><span class="n">Store</span><span class="p">(</span><span class="s2">&quot;start-ev-value&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="mf">0.0</span><span class="p">),</span>
        <span class="n">dcc</span><span class="o">.</span><span class="n">Store</span><span class="p">(</span><span class="s2">&quot;end-ev-value&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="mf">1000.0</span><span class="p">),</span>
        <span class="n">dcc</span><span class="o">.</span><span class="n">Store</span><span class="p">(</span><span class="s2">&quot;ev-step-value&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="mf">0.6</span><span class="p">),</span>
        <span class="n">dcc</span><span class="o">.</span><span class="n">Store</span><span class="p">(</span><span class="s2">&quot;time-step-value&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span>
        <span class="n">dcc</span><span class="o">.</span><span class="n">Store</span><span class="p">(</span><span class="s2">&quot;meas-passes-value&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
        <span class="n">dcc</span><span class="o">.</span><span class="n">Store</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;start-mode&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s2">&quot;single&quot;</span><span class="p">),</span>
        <span class="n">dcc</span><span class="o">.</span><span class="n">Store</span><span class="p">(</span><span class="s2">&quot;batch-seq-dataframe&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">blank_data</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s2">&quot;records&quot;</span><span class="p">)),</span>
        <span class="n">dcc</span><span class="o">.</span><span class="n">Interval</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;progress-interval&quot;</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">dcc</span><span class="o">.</span><span class="n">Interval</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;graph-interval-component&quot;</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
        <span class="n">dcc</span><span class="o">.</span><span class="n">Interval</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;interval-component&quot;</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
        <span class="n">save_file_modal</span><span class="p">,</span>
        <span class="n">dbc</span><span class="o">.</span><span class="n">Row</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">dbc</span><span class="o">.</span><span class="n">Col</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">html</span><span class="o">.</span><span class="n">H1</span><span class="p">(</span>
                            <span class="n">html</span><span class="o">.</span><span class="n">A</span><span class="p">(</span>
                                <span class="s2">&quot;XPS Count&quot;</span><span class="p">,</span>
                                <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;open-offcanvas&quot;</span><span class="p">,</span>
                            <span class="p">)</span>
                        <span class="p">),</span>
                        <span class="n">offcanvas</span><span class="p">,</span>
                    <span class="p">],</span>
                    <span class="n">width</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">],</span>
            <span class="n">class_name</span><span class="o">=</span><span class="s2">&quot;content-rows&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">dbc</span><span class="o">.</span><span class="n">Row</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">dbc</span><span class="o">.</span><span class="n">Col</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">color_mode_switch</span><span class="p">,</span>
                        <span class="n">card</span><span class="p">,</span>
                        <span class="n">source_selection</span><span class="p">,</span>
                        <span class="n">dbc</span><span class="o">.</span><span class="n">Row</span><span class="p">(</span>
                            <span class="p">[</span>
                                <span class="n">dbc</span><span class="o">.</span><span class="n">Col</span><span class="p">(</span>
                                    <span class="n">dbc</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
                                        <span class="s2">&quot;Start&quot;</span><span class="p">,</span>
                                        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;primary&quot;</span><span class="p">,</span>
                                        <span class="n">outline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                        <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;start-click&quot;</span><span class="p">,</span>
                                    <span class="p">),</span>
                                    <span class="n">className</span><span class="o">=</span><span class="s2">&quot;d-grid gap-2 col-6 mx-auto&quot;</span><span class="p">,</span>
                                <span class="p">),</span>
                                <span class="n">dbc</span><span class="o">.</span><span class="n">Col</span><span class="p">(</span>
                                    <span class="n">dbc</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
                                        <span class="s2">&quot;Stop!&quot;</span><span class="p">,</span>
                                        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span>
                                        <span class="n">outline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                        <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;stop-click&quot;</span><span class="p">,</span>
                                        <span class="n">disabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                    <span class="p">),</span>
                                    <span class="n">className</span><span class="o">=</span><span class="s2">&quot;d-grid gap-2 col-6 mx-auto&quot;</span><span class="p">,</span>
                                <span class="p">),</span>
                            <span class="p">],</span>
                            <span class="n">class_name</span><span class="o">=</span><span class="s2">&quot;button-rows&quot;</span><span class="p">,</span>
                        <span class="p">),</span>
                        <span class="n">dbc</span><span class="o">.</span><span class="n">Row</span><span class="p">(</span>
                            <span class="p">[</span>
                                <span class="n">dbc</span><span class="o">.</span><span class="n">Col</span><span class="p">(</span>
                                    <span class="n">dbc</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
                                        <span class="s2">&quot;Save Plot / Results&quot;</span><span class="p">,</span>
                                        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;success&quot;</span><span class="p">,</span>
                                        <span class="n">outline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                        <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;save-results&quot;</span><span class="p">,</span>
                                        <span class="n">disabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                    <span class="p">),</span>
                                    <span class="n">className</span><span class="o">=</span><span class="s2">&quot;d-grid gap-2 col-6 mx-auto&quot;</span><span class="p">,</span>
                                <span class="p">),</span>
                            <span class="p">],</span>
                            <span class="n">class_name</span><span class="o">=</span><span class="s2">&quot;button-rows&quot;</span><span class="p">,</span>
                        <span class="p">),</span>
                        <span class="n">dbc</span><span class="o">.</span><span class="n">Progress</span><span class="p">(</span>
                            <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;progress-bar&quot;</span><span class="p">,</span>
                            <span class="n">value</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">,</span>
                            <span class="n">striped</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">animated</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">class_name</span><span class="o">=</span><span class="s2">&quot;mb-3&quot;</span><span class="p">,</span>
                        <span class="p">),</span>
                        <span class="n">dbc</span><span class="o">.</span><span class="n">Row</span><span class="p">(</span><span class="n">status_displays</span><span class="p">),</span>
                        <span class="n">dbc</span><span class="o">.</span><span class="n">Row</span><span class="p">(</span>
                            <span class="p">[</span>
                                <span class="n">dbc</span><span class="o">.</span><span class="n">Col</span><span class="p">(</span>
                                    <span class="n">dbc</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
                                        <span class="s2">&quot;Shutdown App!&quot;</span><span class="p">,</span>
                                        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;danger&quot;</span><span class="p">,</span>
                                        <span class="n">outline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                        <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;shutdown-app&quot;</span><span class="p">,</span>
                                        <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                    <span class="p">),</span>
                                    <span class="n">className</span><span class="o">=</span><span class="s2">&quot;d-grid gap-2 col-6 mx-auto&quot;</span><span class="p">,</span>
                                <span class="p">),</span>
                            <span class="p">],</span>
                            <span class="n">class_name</span><span class="o">=</span><span class="s2">&quot;shutdown-button-rows&quot;</span><span class="p">,</span>
                            <span class="n">align</span><span class="o">=</span><span class="s2">&quot;end&quot;</span><span class="p">,</span>
                        <span class="p">),</span>
                    <span class="p">],</span>
                    <span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">dbc</span><span class="o">.</span><span class="n">Col</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">dcc</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span>
                            <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;graph&quot;</span><span class="p">,</span>
                            <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
                            <span class="n">config</span><span class="o">=</span><span class="n">CONFIG</span><span class="p">,</span>
                            <span class="n">mathjax</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">className</span><span class="o">=</span><span class="s2">&quot;dcc-graph&quot;</span><span class="p">,</span>
                        <span class="p">),</span>
                        <span class="n">dcc</span><span class="o">.</span><span class="n">Download</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;download-data&quot;</span><span class="p">),</span>
                        <span class="n">dcc</span><span class="o">.</span><span class="n">Download</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;download-plot&quot;</span><span class="p">),</span>
                    <span class="p">],</span>
                    <span class="n">width</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">],</span>
            <span class="n">class_name</span><span class="o">=</span><span class="s2">&quot;content-rows&quot;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">],</span>
    <span class="n">className</span><span class="o">=</span><span class="s2">&quot;app-ui-division&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">http_server</span> <span class="o">=</span> <span class="n">WSGIServer</span><span class="p">(</span>
    <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">8060</span><span class="p">),</span>
    <span class="n">app</span><span class="o">.</span><span class="n">server</span><span class="p">,</span>
<span class="p">)</span>
<span class="sd">&quot;&quot;&quot;The WSGI Production server to run the dash app.&quot;&quot;&quot;</span>

<span class="c1"># ********************************************************************************</span>
<span class="c1"># ********************************************************************************</span>
<span class="c1"># ********************************************************************************</span>
<span class="c1"># ********************************************************************************</span>
<span class="c1"># ********************************************************************************</span>


<span class="n">clientside_callback</span><span class="p">(</span>
    <span class="n">ClientsideFunction</span><span class="p">(</span><span class="s2">&quot;clientside&quot;</span><span class="p">,</span> <span class="s2">&quot;theme_switched&quot;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s2">&quot;switch&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s2">&quot;switch&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">),</span>
    <span class="c1"># prevent_initial_call=True,</span>
<span class="p">)</span>
<span class="sd">&quot;&quot;&quot;Method called on the clientside when the theme switch is toggled.&quot;&quot;&quot;</span>

<span class="c1"># ********************************************************************************</span>


<div class="viewcode-block" id="tab_content">
<a class="viewcode-back" href="../xps_dash.html#xps_dash.tab_content">[docs]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s2">&quot;card-content&quot;</span><span class="p">,</span> <span class="s2">&quot;children&quot;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s2">&quot;start-ev-value&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s2">&quot;end-ev-value&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s2">&quot;ev-step-value&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s2">&quot;time-step-value&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s2">&quot;meas-passes-value&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s2">&quot;batch-seq-dataframe&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s2">&quot;card-tabs&quot;</span><span class="p">,</span> <span class="s2">&quot;active_tab&quot;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s2">&quot;card-content&quot;</span><span class="p">,</span> <span class="s2">&quot;children&quot;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s2">&quot;start-ev-value&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s2">&quot;end-ev-value&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s2">&quot;ev-step-value&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s2">&quot;time-step-value&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s2">&quot;meas-passes-value&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s2">&quot;batch-seq-dataframe&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">),</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">tab_content</span><span class="p">(</span>
    <span class="n">active_tab</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">old_mode</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
    <span class="n">start_ev</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">end_ev</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">ev_step</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">time_step</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">pass_no</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">batch_dataframe</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">dict</span> <span class="o">|</span> <span class="nb">list</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method to update the Dash app content when the tabs are switched between single and batch mode.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    active_tab : str</span>
<span class="sd">        String with the id of the active tab or the tab that was clicked.</span>
<span class="sd">    old_mode : list</span>
<span class="sd">        List of children of the Dash container that was rendered before clicking the tab change.</span>
<span class="sd">    start_ev : float</span>
<span class="sd">        The start eV value from the Store to be shown in start ev field of the Dash app if the single mode tab was clicked.</span>
<span class="sd">    end_ev : float</span>
<span class="sd">        The end eV value from the Store to be shown in end ev field of the Dash app if the single mode tab was clicked.</span>
<span class="sd">    ev_step : float</span>
<span class="sd">        The step eV value from the Store to be shown in step ev field of the Dash app if the single mode tab was clicked.</span>
<span class="sd">    time_step : float</span>
<span class="sd">        The the time per step value from the Store to be shown in time per step field of the Dash app if the single mode tab was clicked.</span>
<span class="sd">    pass_no : int</span>
<span class="sd">        The no. of passes value from the Store to be shown in no. of passes field of the Dash app if the single mode tab was clicked.</span>
<span class="sd">    batch_dataframe : dict</span>
<span class="sd">        The dictionary of values from the Store to be shown in the batch data grid if the batch mode tab was clicked.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple[list, float, float, float, float, int, dict]</span>
<span class="sd">        Returns the list of child entries to be render for the respective active tab, start ev value, end ev value, time per step value, no. of passes value, dictionary with the batch data grid, respectively.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">active_tab</span> <span class="ow">in</span> <span class="s2">&quot;tab-2&quot;</span><span class="p">:</span>
        <span class="n">card_content</span> <span class="o">=</span> <span class="n">generate_batch_data_grid</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">batch_dataframe</span><span class="p">))</span>
        <span class="n">start_ev_mod</span> <span class="o">=</span> <span class="n">old_mode</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;children&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;children&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
        <span class="n">end_ev_mod</span> <span class="o">=</span> <span class="n">old_mode</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;children&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;children&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
        <span class="n">ev_step_mod</span> <span class="o">=</span> <span class="n">old_mode</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;children&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;children&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
        <span class="n">time_step_mod</span> <span class="o">=</span> <span class="n">old_mode</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;children&quot;</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;children&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
        <span class="n">pass_no_mod</span> <span class="o">=</span> <span class="n">old_mode</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;children&quot;</span><span class="p">][</span><span class="mi">4</span><span class="p">][</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;children&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">card_content</span><span class="p">,</span>
            <span class="n">start_ev_mod</span><span class="p">,</span>
            <span class="n">end_ev_mod</span><span class="p">,</span>
            <span class="n">ev_step_mod</span><span class="p">,</span>
            <span class="n">time_step_mod</span><span class="p">,</span>
            <span class="n">pass_no_mod</span><span class="p">,</span>
            <span class="n">batch_dataframe</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">batch_dataframe_mod</span> <span class="o">=</span> <span class="n">old_mode</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;children&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>
        <span class="n">card_content</span> <span class="o">=</span> <span class="n">generate_single_mode_tab_content</span><span class="p">(</span><span class="n">start_ev</span><span class="p">,</span> <span class="n">end_ev</span><span class="p">,</span> <span class="n">ev_step</span><span class="p">,</span> <span class="n">time_step</span><span class="p">,</span> <span class="n">pass_no</span><span class="p">)</span>
        <span class="n">temp_batch_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">batch_dataframe_mod</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s2">&quot;records&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">card_content</span><span class="p">,</span>
            <span class="n">start_ev</span><span class="p">,</span>
            <span class="n">end_ev</span><span class="p">,</span>
            <span class="n">ev_step</span><span class="p">,</span>
            <span class="n">time_step</span><span class="p">,</span>
            <span class="n">pass_no</span><span class="p">,</span>
            <span class="n">temp_batch_data</span><span class="p">,</span>
        <span class="p">)</span></div>



<span class="c1"># ********************************************************************************</span>


<div class="viewcode-block" id="updateFigureTemplate">
<a class="viewcode-back" href="../xps_dash.html#xps_dash.updateFigureTemplate">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s2">&quot;graph&quot;</span><span class="p">,</span> <span class="s2">&quot;figure&quot;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s2">&quot;switch&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s2">&quot;graph&quot;</span><span class="p">,</span> <span class="s2">&quot;figure&quot;</span><span class="p">),</span>
    <span class="c1"># prevent_initial_call=True,</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">updateFigureTemplate</span><span class="p">(</span><span class="n">switch_on</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">ex_fig</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span> <span class="o">|</span> <span class="n">Patch</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method called to change the theme of the figure when the theme of the app is changed.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    switch_on : int</span>
<span class="sd">        Integer indicating the state of the switch. 0 is OFF and 1 is ON.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    plotly.graph_objects.Figure | dash.Patch</span>
<span class="sd">        The plotly figure or dash Patch object to be sent to the graph division of the app.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># When using Patch() to update the figure template, you must use the figure template dict</span>

    <span class="n">template</span> <span class="o">=</span> <span class="n">BOOTSTRAP</span> <span class="k">if</span> <span class="n">switch_on</span> <span class="k">else</span> <span class="n">BOOTSTRAP_DARK</span>

    <span class="n">dark_theme</span> <span class="o">=</span> <span class="kc">False</span> <span class="k">if</span> <span class="n">switch_on</span> <span class="k">else</span> <span class="kc">True</span>

    <span class="n">old_fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">ex_fig</span><span class="p">)</span>

    <span class="n">old_fig</span> <span class="o">=</span> <span class="n">updateRefLinesTheme</span><span class="p">(</span><span class="n">old_fig</span><span class="p">,</span> <span class="n">dark_theme</span><span class="p">)</span>

    <span class="n">patched_figure</span> <span class="o">=</span> <span class="n">Patch</span><span class="p">()</span>
    <span class="n">patched_figure</span><span class="p">[</span><span class="s2">&quot;layout&quot;</span><span class="p">][</span><span class="s2">&quot;template&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">template</span>
    <span class="n">patched_figure</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">old_fig</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">patched_figure</span></div>



<span class="c1"># *********************************************************************************</span>


<div class="viewcode-block" id="prepareForMeasurement">
<a class="viewcode-back" href="../xps_dash.html#xps_dash.prepareForMeasurement">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span>
        <span class="s2">&quot;start-mode&quot;</span><span class="p">,</span>
        <span class="s2">&quot;data&quot;</span><span class="p">,</span>
        <span class="n">allow_duplicate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span>
        <span class="s2">&quot;start-ev-value&quot;</span><span class="p">,</span>
        <span class="s2">&quot;data&quot;</span><span class="p">,</span>
        <span class="n">allow_duplicate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span>
        <span class="s2">&quot;end-ev-value&quot;</span><span class="p">,</span>
        <span class="s2">&quot;data&quot;</span><span class="p">,</span>
        <span class="n">allow_duplicate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span>
        <span class="s2">&quot;ev-step-value&quot;</span><span class="p">,</span>
        <span class="s2">&quot;data&quot;</span><span class="p">,</span>
        <span class="n">allow_duplicate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span>
        <span class="s2">&quot;time-step-value&quot;</span><span class="p">,</span>
        <span class="s2">&quot;data&quot;</span><span class="p">,</span>
        <span class="n">allow_duplicate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span>
        <span class="s2">&quot;meas-passes-value&quot;</span><span class="p">,</span>
        <span class="s2">&quot;data&quot;</span><span class="p">,</span>
        <span class="n">allow_duplicate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span>
        <span class="s2">&quot;batch-seq-dataframe&quot;</span><span class="p">,</span>
        <span class="s2">&quot;data&quot;</span><span class="p">,</span>
        <span class="n">allow_duplicate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s2">&quot;start-click&quot;</span><span class="p">,</span> <span class="s2">&quot;n_clicks&quot;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s2">&quot;card-content&quot;</span><span class="p">,</span> <span class="s2">&quot;children&quot;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s2">&quot;card-tabs&quot;</span><span class="p">,</span> <span class="s2">&quot;active_tab&quot;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s2">&quot;start-ev-value&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s2">&quot;end-ev-value&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s2">&quot;ev-step-value&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s2">&quot;time-step-value&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s2">&quot;meas-passes-value&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s2">&quot;batch-seq-dataframe&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">prepareForMeasurement</span><span class="p">(</span>
    <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">card_body</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
    <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">start_ev</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">end_ev</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">ev_step</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">time_step</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">pass_no</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">batch_dataframe</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method called when the Start button is clicked.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n : int</span>
<span class="sd">        The number of clicks of the Start button. Not used.</span>
<span class="sd">    card_body : list</span>
<span class="sd">        The list of child entries in the current active tab.</span>
<span class="sd">    mode : str</span>
<span class="sd">        The id of the current active tab.</span>
<span class="sd">    start_ev : float</span>
<span class="sd">        The start eV value from the Store.</span>
<span class="sd">    end_ev : float</span>
<span class="sd">        The end eV value from the Store.</span>
<span class="sd">    ev_step : float</span>
<span class="sd">        The step eV value from the Store.</span>
<span class="sd">    time_step : float</span>
<span class="sd">        The time per step value from the Store.</span>
<span class="sd">    pass_no : int</span>
<span class="sd">        The no. of passes value from the Store.</span>
<span class="sd">    batch_dataframe : dict</span>
<span class="sd">        The dict with the batch mode data grid from the Store.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple[str, float, float, float, float, int, dict]</span>
<span class="sd">        Returns the current mode, start ev value, end ev value, step ev value, time per step value, no. of passes value, batch mode data grid, respectively, to the Store components.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="ow">in</span> <span class="s2">&quot;tab-2&quot;</span><span class="p">:</span>
        <span class="n">dataframe</span> <span class="o">=</span> <span class="n">card_body</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;children&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="s2">&quot;batch&quot;</span><span class="p">,</span>
            <span class="n">start_ev</span><span class="p">,</span>
            <span class="n">end_ev</span><span class="p">,</span>
            <span class="n">ev_step</span><span class="p">,</span>
            <span class="n">time_step</span><span class="p">,</span>
            <span class="n">pass_no</span><span class="p">,</span>
            <span class="n">dataframe</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">start_ev_mod</span> <span class="o">=</span> <span class="n">card_body</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;children&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;children&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
        <span class="n">end_ev_mod</span> <span class="o">=</span> <span class="n">card_body</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;children&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;children&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
        <span class="n">ev_step_mod</span> <span class="o">=</span> <span class="n">card_body</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;children&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;children&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
        <span class="n">time_step_mod</span> <span class="o">=</span> <span class="n">card_body</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;children&quot;</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;children&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
        <span class="n">pass_no_mod</span> <span class="o">=</span> <span class="n">card_body</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;children&quot;</span><span class="p">][</span><span class="mi">4</span><span class="p">][</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;children&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;props&quot;</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="s2">&quot;single&quot;</span><span class="p">,</span>
            <span class="n">start_ev_mod</span><span class="p">,</span>
            <span class="n">end_ev_mod</span><span class="p">,</span>
            <span class="n">ev_step_mod</span><span class="p">,</span>
            <span class="n">time_step_mod</span><span class="p">,</span>
            <span class="n">pass_no_mod</span><span class="p">,</span>
            <span class="n">batch_dataframe</span><span class="p">,</span>
        <span class="p">)</span></div>



<span class="c1"># *********************************************************************************</span>


<div class="viewcode-block" id="cancelOrStopMeasurement">
<a class="viewcode-back" href="../xps_dash.html#xps_dash.cancelOrStopMeasurement">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Input</span><span class="p">(</span><span class="s2">&quot;stop-click&quot;</span><span class="p">,</span> <span class="s2">&quot;n_clicks&quot;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">cancelOrStopMeasurement</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method called when the Stop button is clicked on the app.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n : int</span>
<span class="sd">        Integer indicating the number of clicks of the stop-click button.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data_backend</span><span class="o">.</span><span class="n">interruptionClicked</span><span class="p">()</span></div>



<span class="c1"># ***********************************************************************************</span>


<div class="viewcode-block" id="startMeasurement">
<a class="viewcode-back" href="../xps_dash.html#xps_dash.startMeasurement">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span>
        <span class="s2">&quot;check-running&quot;</span><span class="p">,</span>
        <span class="s2">&quot;data&quot;</span><span class="p">,</span>
        <span class="n">allow_duplicate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span>
        <span class="s2">&quot;interval-component&quot;</span><span class="p">,</span>
        <span class="s2">&quot;disabled&quot;</span><span class="p">,</span>
        <span class="n">allow_duplicate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span>
        <span class="s2">&quot;progress-interval&quot;</span><span class="p">,</span>
        <span class="s2">&quot;disabled&quot;</span><span class="p">,</span>
        <span class="n">allow_duplicate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span>
        <span class="s2">&quot;graph&quot;</span><span class="p">,</span>
        <span class="s2">&quot;figure&quot;</span><span class="p">,</span>
        <span class="n">allow_duplicate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s2">&quot;start-mode&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s2">&quot;start-ev-value&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s2">&quot;end-ev-value&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s2">&quot;ev-step-value&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s2">&quot;time-step-value&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s2">&quot;meas-passes-value&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s2">&quot;batch-seq-dataframe&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s2">&quot;source-select&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s2">&quot;switch&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">startMeasurement</span><span class="p">(</span>
    <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">start_ev</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">end_ev</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">ev_step</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">time_step</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">pass_no</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">batch_dataframe</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">source_mg</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">switch_on</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method called after the initial preparation of the measurement was done.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    mode : str</span>
<span class="sd">        String indicating if the mode of the measurement is single or batch mode.</span>
<span class="sd">    start_ev : float</span>
<span class="sd">        The start ev value to be used if a single mode measurement is selected.</span>
<span class="sd">    end_ev : float</span>
<span class="sd">        The end ev value to be used if a single mode measurement is selected.</span>
<span class="sd">    ev_step : float</span>
<span class="sd">        The step ev value to be used if a single mode measurement is selected.</span>
<span class="sd">    time_step : float</span>
<span class="sd">        The time per step value to be used if a single mode measurement is selected.</span>
<span class="sd">    pass_no : int</span>
<span class="sd">        The no. of passes value to be used if a single mode measurement is selected.</span>
<span class="sd">    batch_dataframe : dict</span>
<span class="sd">        The dictionary with the data from the batch data grid if the Batch mode measurement is selected.</span>
<span class="sd">    source_mg : bool</span>
<span class="sd">        Boolean indicating if the source of the X-Ray excitation is Mg.</span>
<span class="sd">    switch_on : bool</span>
<span class="sd">        Boolean indicating if the light mode theme is switched on.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple[bool, bool, bool, plotly.graph_objects.Figure]</span>
<span class="sd">        Boolean indicating if the measurement is running, boolean if the interval-component is to be disabled, boolean if the progress-interval is to be disabled, the plotly Figure object, respectively.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">batch_sett</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">batch_dataframe</span><span class="p">)</span>
    <span class="n">dark_theme</span> <span class="o">=</span> <span class="kc">False</span> <span class="k">if</span> <span class="n">switch_on</span> <span class="k">else</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="ow">in</span> <span class="s2">&quot;single&quot;</span><span class="p">:</span>
        <span class="n">data_backend</span><span class="o">.</span><span class="n">startMeasurement</span><span class="p">(</span><span class="n">start_ev</span><span class="p">,</span> <span class="n">end_ev</span><span class="p">,</span> <span class="n">ev_step</span><span class="p">,</span> <span class="n">time_step</span><span class="p">,</span> <span class="n">pass_no</span><span class="p">,</span> <span class="n">batch_sett</span><span class="p">,</span> <span class="n">source_mg</span><span class="p">)</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">reset_fig</span><span class="p">(</span><span class="n">theme_dark</span><span class="o">=</span><span class="n">dark_theme</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">data_backend</span><span class="o">.</span><span class="n">startMeasurement</span><span class="p">(</span><span class="n">start_ev</span><span class="p">,</span> <span class="n">end_ev</span><span class="p">,</span> <span class="n">ev_step</span><span class="p">,</span> <span class="n">time_step</span><span class="p">,</span> <span class="n">pass_no</span><span class="p">,</span> <span class="n">batch_sett</span><span class="p">,</span> <span class="n">source_mg</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">reset_fig</span><span class="p">(</span><span class="n">theme_dark</span><span class="o">=</span><span class="n">dark_theme</span><span class="p">,</span> <span class="n">batch_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">fig</span></div>



<span class="c1"># ********************************************************************************</span>


<div class="viewcode-block" id="checkRunningProgress">
<a class="viewcode-back" href="../xps_dash.html#xps_dash.checkRunningProgress">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span>
        <span class="s2">&quot;start-click&quot;</span><span class="p">,</span>
        <span class="s2">&quot;disabled&quot;</span><span class="p">,</span>
        <span class="n">allow_duplicate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span>
        <span class="s2">&quot;stop-click&quot;</span><span class="p">,</span>
        <span class="s2">&quot;disabled&quot;</span><span class="p">,</span>
        <span class="n">allow_duplicate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span>
        <span class="s2">&quot;shutdown-app&quot;</span><span class="p">,</span>
        <span class="s2">&quot;disabled&quot;</span><span class="p">,</span>
        <span class="n">allow_duplicate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s2">&quot;meas-select-card&quot;</span><span class="p">,</span> <span class="s2">&quot;class_name&quot;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span>
        <span class="s2">&quot;interval-component&quot;</span><span class="p">,</span>
        <span class="s2">&quot;disabled&quot;</span><span class="p">,</span>
        <span class="n">allow_duplicate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span>
        <span class="s2">&quot;save-results&quot;</span><span class="p">,</span>
        <span class="s2">&quot;disabled&quot;</span><span class="p">,</span>
        <span class="n">allow_duplicate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span>
        <span class="s2">&quot;source-select&quot;</span><span class="p">,</span>
        <span class="s2">&quot;disabled&quot;</span><span class="p">,</span>
        <span class="n">allow_duplicate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s2">&quot;check-running&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">checkRunningProgress</span><span class="p">(</span>
    <span class="n">running</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method called when the check-running boolean in the Store is updated.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    running : bool</span>
<span class="sd">        Boolean indicating if the measurement is running.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple[bool, bool, bool, str, bool, bool, bool]</span>
<span class="sd">        The boolean indicating if the start button is disabled, boolean indicating if the stop button is disabled, boolean indicating if the shutdown button is disabled, the class name for the Card component, boolean indicating if the graph interval is disabled, boolean indicating if the save button is disabled, boolean indicating if the select source switch is disabled, respectively.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">running</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="kc">True</span><span class="p">,</span>  <span class="c1"># disable the start button</span>
            <span class="kc">False</span><span class="p">,</span>  <span class="c1"># disable the stop button</span>
            <span class="kc">True</span><span class="p">,</span>  <span class="c1"># disable the shutdown button</span>
            <span class="s2">&quot;mb-3 card-disable&quot;</span><span class="p">,</span>  <span class="c1"># class name for the Card component</span>
            <span class="kc">False</span><span class="p">,</span>  <span class="c1"># disable the graph interval component</span>
            <span class="kc">True</span><span class="p">,</span>  <span class="c1"># disable the save results button</span>
            <span class="kc">True</span><span class="p">,</span>  <span class="c1"># disable the source select switch</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="kc">False</span><span class="p">,</span>  <span class="c1"># disable the start button</span>
            <span class="kc">True</span><span class="p">,</span>  <span class="c1"># disable the stop button</span>
            <span class="kc">False</span><span class="p">,</span>  <span class="c1"># disable the shutdown button</span>
            <span class="s2">&quot;mb-3&quot;</span><span class="p">,</span>  <span class="c1"># class name for the Card component</span>
            <span class="kc">True</span> <span class="k">if</span> <span class="n">data_backend</span><span class="o">.</span><span class="n">meas_completed</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># disable the graph interval component</span>
            <span class="kc">False</span><span class="p">,</span>  <span class="c1"># disable the save results button</span>
            <span class="kc">False</span><span class="p">,</span>  <span class="c1"># disable the source select switch</span>
        <span class="p">)</span></div>



<span class="c1"># ********************************************************************************</span>


<div class="viewcode-block" id="updateProgress">
<a class="viewcode-back" href="../xps_dash.html#xps_dash.updateProgress">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s2">&quot;progress-bar&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s2">&quot;check-running&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s2">&quot;kin-energy-disp&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s2">&quot;binding-energy-disp&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s2">&quot;time-elapsed-disp&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s2">&quot;time-remain-disp&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s2">&quot;progress-interval&quot;</span><span class="p">,</span> <span class="s2">&quot;n_intervals&quot;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">updateProgress</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method called by the progress-interval interval component on firing.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n : int</span>
<span class="sd">        Integer indicating the number of intervals the interval component was fired.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple[int, bool, float, float, float, float]</span>
<span class="sd">        Integer for the current value of the progress bar, boolean indicating if the measurement is running, current kinetic energy value of the measurement, current binding energy value of the measurement, the elapsed time of the measurement, the remaining time of the measurement, respectively.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">data_backend</span><span class="o">.</span><span class="n">current_progress</span><span class="p">,</span>
        <span class="n">data_backend</span><span class="o">.</span><span class="n">meas_running</span><span class="p">,</span>
        <span class="n">data_backend</span><span class="o">.</span><span class="n">current_kinetic_energy</span><span class="p">,</span>
        <span class="n">data_backend</span><span class="o">.</span><span class="n">current_binding_energy</span><span class="p">,</span>
        <span class="n">data_backend</span><span class="o">.</span><span class="n">elapsed_time</span><span class="p">,</span>
        <span class="n">data_backend</span><span class="o">.</span><span class="n">remaining_time</span><span class="p">,</span>
    <span class="p">)</span></div>



<span class="c1"># ********************************************************************************</span>


<div class="viewcode-block" id="updateGraphLive">
<a class="viewcode-back" href="../xps_dash.html#xps_dash.updateGraphLive">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span>
        <span class="s2">&quot;graph&quot;</span><span class="p">,</span>
        <span class="s2">&quot;figure&quot;</span><span class="p">,</span>
        <span class="n">allow_duplicate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span>
        <span class="s2">&quot;interval-component&quot;</span><span class="p">,</span>
        <span class="s2">&quot;disabled&quot;</span><span class="p">,</span>
        <span class="n">allow_duplicate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s2">&quot;interval-component&quot;</span><span class="p">,</span> <span class="s2">&quot;n_intervals&quot;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">updateGraphLive</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Patch</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method that is called in periodic intervals.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n : int</span>
<span class="sd">        The iteration of the update interval.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple[dash.Patch, bool]</span>
<span class="sd">        The patch for the figure object and the boolean indicating if the interval-component is to be disabled.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">patched_figure</span> <span class="o">=</span> <span class="n">Patch</span><span class="p">()</span>
    <span class="n">old_fig</span> <span class="o">=</span> <span class="n">data_backend</span><span class="o">.</span><span class="n">plot_fig</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">old_fig</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>
    <span class="n">patched_figure</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>

    <span class="k">return</span> <span class="n">patched_figure</span><span class="p">,</span> <span class="ow">not</span> <span class="n">data_backend</span><span class="o">.</span><span class="n">meas_running</span></div>



<span class="c1"># *********************************************************************************</span>


<div class="viewcode-block" id="confirmFileSaveModalOpen">
<a class="viewcode-back" href="../xps_dash.html#xps_dash.confirmFileSaveModalOpen">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span>
        <span class="s2">&quot;modal&quot;</span><span class="p">,</span>
        <span class="s2">&quot;is_open&quot;</span><span class="p">,</span>
        <span class="n">allow_duplicate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s2">&quot;save-results&quot;</span><span class="p">,</span> <span class="s2">&quot;n_clicks&quot;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s2">&quot;cancel-save&quot;</span><span class="p">,</span> <span class="s2">&quot;n_clicks&quot;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s2">&quot;modal&quot;</span><span class="p">,</span> <span class="s2">&quot;is_open&quot;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">confirmFileSaveModalOpen</span><span class="p">(</span><span class="n">n1</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">n2</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">is_open</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method called when the Save results button is clicked. It will open a Modal to confirm the file save.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n1 : int</span>
<span class="sd">        Integer holding the no. of clicks on the Save button.</span>
<span class="sd">    n2 : int</span>
<span class="sd">        Integer holding the number of clicks on the Cancel button in the Modal.</span>
<span class="sd">    is_open : bool</span>
<span class="sd">        Boolean indicating if the Modal is currently open.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">        Boolean indicating if the Modal is to be opened.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n1</span> <span class="ow">or</span> <span class="n">n2</span><span class="p">:</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="n">is_open</span>
    <span class="k">return</span> <span class="n">is_open</span></div>



<span class="c1"># *********************************************************************************</span>


<div class="viewcode-block" id="checkFilenameValidity">
<a class="viewcode-back" href="../xps_dash.html#xps_dash.checkFilenameValidity">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s2">&quot;confirm-save&quot;</span><span class="p">,</span> <span class="s2">&quot;disabled&quot;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s2">&quot;save-as-file&quot;</span><span class="p">,</span> <span class="s2">&quot;valid&quot;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s2">&quot;save-as-file&quot;</span><span class="p">,</span> <span class="s2">&quot;invalid&quot;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s2">&quot;save-as-file&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">checkFilenameValidity</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method to check filename validity.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : str</span>
<span class="sd">        Name of the file to be saved as.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple[bool, bool, bool]</span>
<span class="sd">        Boolean to disabled the save button in the modal, enable valid property of the input field, enable invalid property of the input field respectively.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;[^.</span><span class="se">\\</span><span class="s1">/:*?&quot;</span><span class="se">\&#39;</span><span class="s1">&lt;&gt;|]+&#39;</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">fullmatch</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span></div>

    
<span class="c1"># ********************************************************************************  </span>


<div class="viewcode-block" id="saveDataAndPlot">
<a class="viewcode-back" href="../xps_dash.html#xps_dash.saveDataAndPlot">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span>
        <span class="s2">&quot;modal&quot;</span><span class="p">,</span>
        <span class="s2">&quot;is_open&quot;</span><span class="p">,</span>
        <span class="n">allow_duplicate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s2">&quot;confirm-save&quot;</span><span class="p">,</span> <span class="s2">&quot;n_clicks&quot;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s2">&quot;graph&quot;</span><span class="p">,</span> <span class="s2">&quot;figure&quot;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s2">&quot;save-as-file&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">saveDataAndPlot</span><span class="p">(</span><span class="n">n_clicks</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">ex_fig</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method called when Save Results button is clicked.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n_clicks : int</span>
<span class="sd">        Integer indicating the number of times the save-results button was clicked.</span>
<span class="sd">    ex_fig : dict</span>
<span class="sd">        The dictionary with the figure object of the graph area in the Dash app.</span>
<span class="sd">    filename : str</span>
<span class="sd">        The filename to save the results and plot as.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">        The boolean to close the Modal.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">old_fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">ex_fig</span><span class="p">)</span>
    <span class="n">old_fig</span><span class="o">.</span><span class="n">write_html</span><span class="p">(</span>
        <span class="n">filename</span> <span class="o">+</span> <span class="s2">&quot;.html&quot;</span><span class="p">,</span>
        <span class="n">config</span><span class="o">=</span><span class="n">CONFIG</span><span class="p">,</span>
        <span class="n">include_plotlyjs</span><span class="o">=</span><span class="s2">&quot;cdn&quot;</span><span class="p">,</span>
        <span class="n">include_mathjax</span><span class="o">=</span><span class="s2">&quot;cdn&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">data_backend</span><span class="o">.</span><span class="n">saveMeasurementData</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">False</span></div>



<span class="c1"># *********************************************************************************</span>


<div class="viewcode-block" id="shutdownApp">
<a class="viewcode-back" href="../xps_dash.html#xps_dash.shutdownApp">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Input</span><span class="p">(</span><span class="s2">&quot;shutdown-app&quot;</span><span class="p">,</span> <span class="s2">&quot;n_clicks&quot;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">shutdownApp</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method called when the shutdown-app button is clicked.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n : int</span>
<span class="sd">        Integer indicating the number of times the shutdown-app button was clicked.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data_backend</span><span class="o">.</span><span class="n">onClose</span><span class="p">()</span></div>



<span class="c1"># *********************************************************************************</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="c1"># app.run(debug=True, port=&quot;8060&quot;)</span>
    <span class="c1"># app.server.http_server.serve_forever()</span>
    <span class="n">waitress</span><span class="o">.</span><span class="n">serve</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">server</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="s2">&quot;8060&quot;</span><span class="p">,</span> <span class="n">expose_tracebacks</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Ashley Dalmeida
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=2709fde1"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../_static/./furo_mod.js?v=fb588d8d"></script>
    </body>
</html>